import{C as e,L as t,m as r}from"./index-C7lpuH7l.esm.min.js";import{WebGPUEngine as s}from"./webgpuEngine-_lqVauYi.esm.min.js";import"./instancesVertex-D54hsXLH.esm.min.js";import"./bakedVertexAnimation-D0Lo47M5.esm.min.js";import"./instancesDeclaration-Ci-qCpAz.esm.min.js";import"./helperFunctions-BkIwyaq_.esm.min.js";import"./fresnelFunction-D32YfyH_.esm.min.js";import"./meshUboDeclaration-CU-5WBoM.esm.min.js";import"./sceneUboDeclaration-CUhiaE1_.esm.min.js";import"./decalFragment-OsBBxVgS.esm.min.js";import"./audioEngine-Dxu8PeXf.esm.min.js";s.prototype.unBindMultiColorAttachmentFramebuffer=function(e,t=!1,r){r&&r(),this._endCurrentRenderPass(),e.disableAutomaticMSAAResolve||this.resolveMultiFramebuffer(e,!1),t||this.generateMipMapsMultiFramebuffer(e),this._currentRenderTarget=null,this._mrtAttachments=[],this._cacheRenderPipeline.setMRT([]),this._cacheRenderPipeline.setMRTAttachments(this._mrtAttachments)},s.prototype.createMultipleRenderTarget=function(s,n,a){let i=!1,p=!0,o=!1,u=!1,l=e.TEXTUREFORMAT_DEPTH16,T=1,c=1;const h=e.TEXTURETYPE_UNSIGNED_BYTE,m=e.TEXTURE_TRILINEAR_SAMPLINGMODE,E=e.TEXTUREFORMAT_RGBA,_=e.TEXTURE_2D;let R=[],f=[],d=[],M=[],g=[],A=[],x=[],D=[],F=[],S=[],b=!1;const U=this._createHardwareRenderTargetWrapper(!0,!1,s);void 0!==n&&(i=n.generateMipMaps??!1,p=n.generateDepthBuffer??!0,o=n.generateStencilBuffer??!1,u=n.generateDepthTexture??!1,T=n.textureCount??1,l=n.depthTextureFormat??e.TEXTUREFORMAT_DEPTH16,R=n.types||R,f=n.samplingModes||f,d=n.useSRGBBuffers||d,M=n.formats||M,g=n.targetTypes||g,A=n.faceIndex||A,x=n.layerIndex||x,D=n.layerCounts||D,F=n.labels||F,S=n.creationFlags||S,c=n.samples??c,b=n.dontCreateTextures??!1);const P=s.width??s,X=s.height??s,y=[],C=[],L=[];U.label=n?.label??"MultiRenderTargetWrapper",U._generateDepthBuffer=p,U._generateStencilBuffer=o,U._attachments=C,U._defaultAttachments=L;let B=null;(p||o||u)&&!b&&(u||(l=p&&o?e.TEXTUREFORMAT_DEPTH24_STENCIL8:p?e.TEXTUREFORMAT_DEPTH32_FLOAT:e.TEXTUREFORMAT_STENCIL8),B=U.createDepthStencilTexture(0,!1,o,1,l,U.label+"-DepthStencil"));const O=void 0!==n&&"object"==typeof n&&n.createMipMaps&&!i;for(let s=0;s<T;s++){let n=f[s]||m,p=R[s]||h;const o=M[s]||E,u=!!d[s]&&this._caps.supportSRGBBuffers,l=g[s]||_,T=D[s]??1,c=S[s];if((p!==e.TEXTURETYPE_FLOAT||this._caps.textureFloatLinearFiltering)&&(p!==e.TEXTURETYPE_HALF_FLOAT||this._caps.textureHalfFloatLinearFiltering)||(n=e.TEXTURE_NEAREST_SAMPLINGMODE),p!==e.TEXTURETYPE_FLOAT||this._caps.textureFloat||(p=e.TEXTURETYPE_UNSIGNED_BYTE,t.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type")),C.push(s+1),L.push(a?s+1:0===s?1:0),-1===l||b)continue;const A=new r(this,6);switch(y[s]=A,l){case e.TEXTURE_CUBE_MAP:A.isCube=!0;break;case e.TEXTURE_3D:A.is3D=!0,A.baseDepth=A.depth=T;break;case e.TEXTURE_2D_ARRAY:A.is2DArray=!0,A.baseDepth=A.depth=T}A.baseWidth=P,A.baseHeight=X,A.width=P,A.height=X,A.isReady=!0,A.samples=1,A.generateMipMaps=i,A.samplingMode=n,A.type=p,A._cachedWrapU=e.TEXTURE_CLAMP_ADDRESSMODE,A._cachedWrapV=e.TEXTURE_CLAMP_ADDRESSMODE,A._useSRGBBuffer=u,A.format=o,A.label=F[s]??U.label+"-Texture"+s,this._internalTexturesCache.push(A),O&&(A.generateMipMaps=!0),this._textureHelper.createGPUTextureForInternalTexture(A,void 0,void 0,void 0,c),O&&(A.generateMipMaps=!1)}return B&&(B.incrementReferences(),y[T]=B,this._internalTexturesCache.push(B)),U.setTextures(y),U.setLayerAndFaceIndices(x,A),b?U._samples=c:this.updateMultipleRenderTargetTextureSampleCount(U,c),U},s.prototype.updateMultipleRenderTargetTextureSampleCount=function(e,t){if(!e||!e.textures||0===e.textures.length||e.textures[0].samples===t)return t;const r=e.textures.length;if(0===r)return 1;t=Math.min(t,this.getCaps().maxMSAASamples);for(let t=0;t<r;++t){const r=e.textures[t]._hardwareTexture;r?.releaseMSAATextures()}for(let s=0;s<r;++s){e.textures[s].samples=t}return e._depthStencilTexture&&(e._depthStencilTexture.samples=t),e._samples=t,t},s.prototype.generateMipMapsMultiFramebuffer=function(e){const t=e;if(!t.isMulti)return;const r=t._attachments.length;for(let e=0;e<r;e++){const r=t.textures[e];!r.generateMipMaps||r.isCube||r.is3D||this._generateMipmaps(r)}},s.prototype.resolveMultiFramebuffer=function(e,t=!0){this.resolveFramebuffer(e,t)},s.prototype.bindAttachments=function(e){0!==e.length&&this._currentRenderTarget&&(this._mrtAttachments=e,this._currentRenderPass&&this._cacheRenderPipeline.setMRTAttachments(e))},s.prototype.buildTextureLayout=function(e,t=!1){const r=[];if(t)r.push(1);else for(let t=0;t<e.length;t++)e[t]?r.push(t+1):r.push(0);return r},s.prototype.restoreSingleAttachment=function(){},s.prototype.restoreSingleAttachmentForRenderTarget=function(){};
//# sourceMappingURL=engine.multiRender-BgP1BPfI.esm.min.js.map
