{"version":3,"file":"webAudioStreamingSound-Bb02H5Tl.esm.min.js","sources":["../../../../../dev/core/dist/AudioV2/abstractAudio/streamingSound.js","../../../../../dev/core/dist/AudioV2/abstractAudio/streamingSoundInstance.js","../../../../../dev/core/dist/AudioV2/webAudio/webAudioStreamingSound.js"],"sourcesContent":["import { AbstractSound } from \"./abstractSound\";\n/**\n * Abstract class representing a streaming sound.\n *\n * A streaming sound has a sound buffer that is loaded into memory in chunks as it is played. This allows it to be played\n * more quickly than a static sound, but it also means that it cannot have loop points or playback rate changes.\n *\n * Due to the way streaming sounds are typically implemented, there can be a significant delay when attempting to play\n * a streaming sound for the first time. To prevent this delay, it is recommended to preload instances of the sound\n * using the {@link IStreamingSoundStoredOptions.preloadCount} options, or the {@link preloadInstanceAsync} and\n * {@link preloadInstancesAsync} methods before calling the `play` method.\n *\n * Streaming sounds are created by the {@link CreateStreamingSoundAsync} function.\n */\nexport class StreamingSound extends AbstractSound {\n    constructor(name, engine, options) {\n        super(name, engine, options);\n        this._preloadedInstances = new Array();\n    }\n    /**\n     * The number of instances to preload. Defaults to `1`.\n     */\n    get preloadCount() {\n        return this._options.preloadCount ?? 1;\n    }\n    /**\n     * Returns the number of instances that have been preloaded.\n     */\n    get preloadCompletedCount() {\n        return this._preloadedInstances.length;\n    }\n    /**\n     * Preloads an instance of the sound.\n     * @returns A promise that resolves when the instance is preloaded.\n     */\n    // eslint-disable-next-line @typescript-eslint/promise-function-async, no-restricted-syntax\n    preloadInstanceAsync() {\n        const instance = this._createInstance();\n        this._addPreloadedInstance(instance);\n        return instance.preloadedPromise;\n    }\n    /**\n     * Preloads the given number of instances of the sound.\n     * @param count - The number of instances to preload.\n     * @returns A promise that resolves when all instances are preloaded.\n     */\n    async preloadInstancesAsync(count) {\n        for (let i = 0; i < count; i++) {\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            this.preloadInstanceAsync();\n        }\n        await Promise.all(this._preloadedInstances.map(async (instance) => await instance.preloadedPromise));\n    }\n    /**\n     * Plays the sound.\n     * - Triggers `onEndedObservable` if played for the full duration and the `loop` option is not set.\n     * @param options The options to use when playing the sound. Options set here override the sound's options.\n     */\n    play(options = {}) {\n        if (this.state === 5 /* SoundState.Paused */) {\n            this.resume();\n            return;\n        }\n        let instance;\n        if (this.preloadCompletedCount > 0) {\n            instance = this._preloadedInstances[0];\n            instance.startOffset = this.startOffset;\n            this._removePreloadedInstance(instance);\n        }\n        else {\n            instance = this._createInstance();\n        }\n        const onInstanceStateChanged = () => {\n            if (instance.state === 3 /* SoundState.Started */) {\n                this._stopExcessInstances();\n                instance.onStateChangedObservable.removeCallback(onInstanceStateChanged);\n            }\n        };\n        instance.onStateChangedObservable.add(onInstanceStateChanged);\n        options.startOffset ??= this.startOffset;\n        options.loop ??= this.loop;\n        options.volume ??= 1;\n        this._beforePlay(instance);\n        instance.play(options);\n        this._afterPlay(instance);\n    }\n    /**\n     * Stops the sound.\n     */\n    stop() {\n        this._setState(1 /* SoundState.Stopped */);\n        if (!this._instances) {\n            return;\n        }\n        for (const instance of Array.from(this._instances)) {\n            instance.stop();\n        }\n    }\n    _addPreloadedInstance(instance) {\n        if (!this._preloadedInstances.includes(instance)) {\n            this._preloadedInstances.push(instance);\n        }\n    }\n    _removePreloadedInstance(instance) {\n        const index = this._preloadedInstances.indexOf(instance);\n        if (index !== -1) {\n            this._preloadedInstances.splice(index, 1);\n        }\n    }\n}\n//# sourceMappingURL=streamingSound.js.map","import { Observable } from \"../../Misc/observable\";\nimport { _AbstractSoundInstance } from \"./abstractSoundInstance\";\n/** @internal */\nexport class _StreamingSoundInstance extends _AbstractSoundInstance {\n    constructor(sound) {\n        super(sound);\n        /** @internal */\n        this.onReadyObservable = new Observable();\n        /** @internal */\n        this.preloadedPromise = new Promise((resolve, reject) => {\n            this._rejectPreloadedProimse = reject;\n            this._resolvePreloadedPromise = resolve;\n        });\n        this.onErrorObservable.add(this._rejectPreloadedProimse);\n        this.onReadyObservable.add(this._resolvePreloadedPromise);\n    }\n    /** @internal */\n    set startOffset(value) {\n        this._options.startOffset = value;\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this.onErrorObservable.clear();\n        this.onReadyObservable.clear();\n        this._resolvePreloadedPromise();\n    }\n}\n//# sourceMappingURL=streamingSoundInstance.js.map","import { Logger } from \"../../Misc/logger\";\nimport { Tools } from \"../../Misc/tools\";\nimport { StreamingSound } from \"../abstractAudio/streamingSound\";\nimport { _StreamingSoundInstance } from \"../abstractAudio/streamingSoundInstance\";\nimport { _HasSpatialAudioOptions } from \"../abstractAudio/subProperties/abstractSpatialAudio\";\nimport { _StereoAudio } from \"../abstractAudio/subProperties/stereoAudio\";\nimport { _CleanUrl } from \"../audioUtils\";\nimport { _WebAudioBusAndSoundSubGraph } from \"./subNodes/webAudioBusAndSoundSubGraph\";\nimport { _SpatialWebAudio } from \"./subProperties/spatialWebAudio\";\n/** @internal */\nexport class _WebAudioStreamingSound extends StreamingSound {\n    /** @internal */\n    constructor(name, engine, options) {\n        super(name, engine, options);\n        this._stereo = null;\n        this._options = {\n            autoplay: options.autoplay ?? false,\n            loop: options.loop ?? false,\n            maxInstances: options.maxInstances ?? Infinity,\n            preloadCount: options.preloadCount ?? 1,\n            startOffset: options.startOffset ?? 0,\n        };\n        this._subGraph = new _WebAudioStreamingSound._SubGraph(this);\n    }\n    /** @internal */\n    async _initAsync(source, options) {\n        const audioContext = this.engine._audioContext;\n        if (!(audioContext instanceof AudioContext)) {\n            throw new Error(\"Unsupported audio context type.\");\n        }\n        this._audioContext = audioContext;\n        this._source = source;\n        if (options.outBus) {\n            this.outBus = options.outBus;\n        }\n        else if (options.outBusAutoDefault !== false) {\n            await this.engine.isReadyPromise;\n            this.outBus = this.engine.defaultMainBus;\n        }\n        await this._subGraph.initAsync(options);\n        if (_HasSpatialAudioOptions(options)) {\n            this._initSpatialProperty();\n        }\n        if (this.preloadCount) {\n            await this.preloadInstancesAsync(this.preloadCount);\n        }\n        if (options.autoplay) {\n            this.play(options);\n        }\n        this.engine._addSound(this);\n    }\n    /** @internal */\n    get _inNode() {\n        return this._subGraph._inNode;\n    }\n    /** @internal */\n    get _outNode() {\n        return this._subGraph._outNode;\n    }\n    /** @internal */\n    get stereo() {\n        return this._stereo ?? (this._stereo = new _StereoAudio(this._subGraph));\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._stereo = null;\n        this._subGraph.dispose();\n        this.engine._removeSound(this);\n    }\n    /** @internal */\n    getClassName() {\n        return \"_WebAudioStreamingSound\";\n    }\n    _createInstance() {\n        return new _WebAudioStreamingSoundInstance(this, this._options);\n    }\n    _connect(node) {\n        const connected = super._connect(node);\n        if (!connected) {\n            return false;\n        }\n        // If the wrapped node is not available now, it will be connected later by the subgraph.\n        if (node._inNode) {\n            this._outNode?.connect(node._inNode);\n        }\n        return true;\n    }\n    _disconnect(node) {\n        const disconnected = super._disconnect(node);\n        if (!disconnected) {\n            return false;\n        }\n        if (node._inNode) {\n            this._outNode?.disconnect(node._inNode);\n        }\n        return true;\n    }\n    _createSpatialProperty(autoUpdate, minUpdateTime) {\n        return new _SpatialWebAudio(this._subGraph, autoUpdate, minUpdateTime);\n    }\n    _getOptions() {\n        return this._options;\n    }\n}\n_WebAudioStreamingSound._SubGraph = class extends _WebAudioBusAndSoundSubGraph {\n    get _downstreamNodes() {\n        return this._owner._downstreamNodes ?? null;\n    }\n    get _upstreamNodes() {\n        return this._owner._upstreamNodes ?? null;\n    }\n};\n/** @internal */\nclass _WebAudioStreamingSoundInstance extends _StreamingSoundInstance {\n    constructor(sound, options) {\n        super(sound);\n        this._currentTimeChangedWhilePaused = false;\n        this._enginePlayTime = Infinity;\n        this._enginePauseTime = 0;\n        this._isReady = false;\n        this._isReadyPromise = new Promise((resolve, reject) => {\n            this._resolveIsReadyPromise = resolve;\n            this._rejectIsReadyPromise = reject;\n        });\n        this._onCanPlayThrough = () => {\n            this._isReady = true;\n            this._resolveIsReadyPromise(this._mediaElement);\n            this.onReadyObservable.notifyObservers(this);\n        };\n        this._onEnded = () => {\n            this.onEndedObservable.notifyObservers(this);\n            this.dispose();\n        };\n        this._onError = (reason) => {\n            this._setState(4 /* SoundState.FailedToStart */);\n            this.onErrorObservable.notifyObservers(reason);\n            this._rejectIsReadyPromise(reason);\n            this.dispose();\n        };\n        this._onEngineStateChanged = () => {\n            if (this.engine.state !== \"running\") {\n                return;\n            }\n            if (this._options.loop && this.state === 2 /* SoundState.Starting */) {\n                this.play();\n            }\n            this.engine.stateChangedObservable.removeCallback(this._onEngineStateChanged);\n        };\n        this._onUserGesture = () => {\n            this.play();\n        };\n        this._options = options;\n        this._volumeNode = new GainNode(sound._audioContext);\n        if (typeof sound._source === \"string\") {\n            this._initFromUrl(sound._source);\n        }\n        else if (Array.isArray(sound._source)) {\n            this._initFromUrls(sound._source);\n        }\n        else if (sound._source instanceof HTMLMediaElement) {\n            this._initFromMediaElement(sound._source);\n        }\n        else {\n            throw new Error(`Invalid streaming sound source (${sound._source}).`);\n        }\n    }\n    /** @internal */\n    get currentTime() {\n        if (this._state === 1 /* SoundState.Stopped */) {\n            return 0;\n        }\n        const timeSinceLastStart = this._state === 5 /* SoundState.Paused */ ? 0 : this.engine.currentTime - this._enginePlayTime;\n        return this._enginePauseTime + timeSinceLastStart + this._options.startOffset;\n    }\n    set currentTime(value) {\n        const restart = this._state === 2 /* SoundState.Starting */ || this._state === 3 /* SoundState.Started */;\n        if (restart) {\n            this._mediaElement.pause();\n            this._state = 1 /* SoundState.Stopped */;\n        }\n        this._options.startOffset = value;\n        if (restart) {\n            this.play({ startOffset: value });\n        }\n        else if (this._state === 5 /* SoundState.Paused */) {\n            this._currentTimeChangedWhilePaused = true;\n        }\n    }\n    get _outNode() {\n        return this._volumeNode;\n    }\n    /** @internal */\n    get startTime() {\n        if (this._state === 1 /* SoundState.Stopped */) {\n            return 0;\n        }\n        return this._enginePlayTime;\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this.stop();\n        this._sourceNode?.disconnect(this._volumeNode);\n        this._sourceNode = null;\n        this._mediaElement.removeEventListener(\"error\", this._onError);\n        this._mediaElement.removeEventListener(\"ended\", this._onEnded);\n        this._mediaElement.removeEventListener(\"canplaythrough\", this._onCanPlayThrough);\n        for (const source of Array.from(this._mediaElement.children)) {\n            this._mediaElement.removeChild(source);\n        }\n        this.engine.stateChangedObservable.removeCallback(this._onEngineStateChanged);\n        this.engine.userGestureObservable.removeCallback(this._onUserGesture);\n    }\n    /** @internal */\n    play(options = {}) {\n        if (this._state === 3 /* SoundState.Started */) {\n            return;\n        }\n        if (options.loop !== undefined) {\n            this._options.loop = options.loop;\n        }\n        this._mediaElement.loop = this._options.loop;\n        let startOffset = options.startOffset;\n        if (this._currentTimeChangedWhilePaused) {\n            startOffset = this._options.startOffset;\n            this._currentTimeChangedWhilePaused = false;\n        }\n        else if (this._state === 5 /* SoundState.Paused */) {\n            startOffset = this.currentTime + this._options.startOffset;\n        }\n        if (startOffset && startOffset > 0) {\n            this._mediaElement.currentTime = startOffset;\n        }\n        this._volumeNode.gain.value = options.volume ?? 1;\n        this._play();\n    }\n    /** @internal */\n    pause() {\n        if (this._state !== 2 /* SoundState.Starting */ && this._state !== 3 /* SoundState.Started */) {\n            return;\n        }\n        this._setState(5 /* SoundState.Paused */);\n        this._enginePauseTime += this.engine.currentTime - this._enginePlayTime;\n        this._mediaElement.pause();\n    }\n    /** @internal */\n    resume() {\n        if (this._state === 5 /* SoundState.Paused */) {\n            this.play();\n        }\n        else if (this._currentTimeChangedWhilePaused) {\n            this.play();\n        }\n    }\n    /** @internal */\n    stop() {\n        if (this._state === 1 /* SoundState.Stopped */) {\n            return;\n        }\n        this._stop();\n    }\n    /** @internal */\n    getClassName() {\n        return \"_WebAudioStreamingSoundInstance\";\n    }\n    _connect(node) {\n        const connected = super._connect(node);\n        if (!connected) {\n            return false;\n        }\n        // If the wrapped node is not available now, it will be connected later by the sound's subgraph.\n        if (node instanceof _WebAudioStreamingSound && node._inNode) {\n            this._outNode?.connect(node._inNode);\n        }\n        return true;\n    }\n    _disconnect(node) {\n        const disconnected = super._disconnect(node);\n        if (!disconnected) {\n            return false;\n        }\n        if (node instanceof _WebAudioStreamingSound && node._inNode) {\n            this._outNode?.disconnect(node._inNode);\n        }\n        return true;\n    }\n    _initFromMediaElement(mediaElement) {\n        Tools.SetCorsBehavior(mediaElement.currentSrc, mediaElement);\n        mediaElement.controls = false;\n        mediaElement.loop = this._options.loop;\n        mediaElement.preload = \"auto\";\n        mediaElement.addEventListener(\"canplaythrough\", this._onCanPlayThrough, { once: true });\n        mediaElement.addEventListener(\"ended\", this._onEnded, { once: true });\n        mediaElement.addEventListener(\"error\", this._onError, { once: true });\n        mediaElement.load();\n        this._sourceNode = new MediaElementAudioSourceNode(this._sound._audioContext, { mediaElement: mediaElement });\n        this._sourceNode.connect(this._volumeNode);\n        if (!this._connect(this._sound)) {\n            throw new Error(\"Connect failed\");\n        }\n        this._mediaElement = mediaElement;\n    }\n    _initFromUrl(url) {\n        const audio = new Audio(_CleanUrl(url));\n        this._initFromMediaElement(audio);\n    }\n    _initFromUrls(urls) {\n        const audio = new Audio();\n        for (const url of urls) {\n            const source = document.createElement(\"source\");\n            source.src = _CleanUrl(url);\n            audio.appendChild(source);\n        }\n        this._initFromMediaElement(audio);\n    }\n    _play() {\n        this._setState(2 /* SoundState.Starting */);\n        if (!this._isReady) {\n            this._playWhenReady();\n            return;\n        }\n        if (this._state !== 2 /* SoundState.Starting */) {\n            return;\n        }\n        if (this.engine.state === \"running\") {\n            const result = this._mediaElement.play();\n            this._enginePlayTime = this.engine.currentTime;\n            this._setState(3 /* SoundState.Started */);\n            // It's possible that the play() method fails on Safari, even if the audio engine's state is \"running\".\n            // This occurs when the audio context is paused by the system and resumed automatically by the audio engine\n            // without a user interaction (e.g. when the Vision Pro exits and reenters immersive mode).\n            // eslint-disable-next-line github/no-then\n            result.catch(() => {\n                this._setState(4 /* SoundState.FailedToStart */);\n                if (this._options.loop) {\n                    this.engine.userGestureObservable.addOnce(this._onUserGesture);\n                }\n            });\n        }\n        else if (this._options.loop) {\n            this.engine.stateChangedObservable.add(this._onEngineStateChanged);\n        }\n        else {\n            this.stop();\n            this._setState(4 /* SoundState.FailedToStart */);\n        }\n    }\n    _playWhenReady() {\n        this._isReadyPromise\n            // eslint-disable-next-line github/no-then\n            .then(() => {\n            this._play();\n        })\n            // eslint-disable-next-line github/no-then\n            .catch(() => {\n            Logger.Error(\"Streaming sound instance failed to play\");\n            this._setState(4 /* SoundState.FailedToStart */);\n        });\n    }\n    _stop() {\n        this._mediaElement.pause();\n        this._setState(1 /* SoundState.Stopped */);\n        this._onEnded();\n        this.engine.stateChangedObservable.removeCallback(this._onEngineStateChanged);\n    }\n}\n//# sourceMappingURL=webAudioStreamingSound.js.map"],"names":["StreamingSound","AbstractSound","constructor","name","engine","options","super","this","_preloadedInstances","Array","preloadCount","_options","preloadCompletedCount","length","preloadInstanceAsync","instance","_createInstance","_addPreloadedInstance","preloadedPromise","preloadInstancesAsync","count","i","Promise","all","map","async","play","state","resume","startOffset","_removePreloadedInstance","onInstanceStateChanged","_stopExcessInstances","onStateChangedObservable","removeCallback","add","loop","volume","_beforePlay","_afterPlay","stop","_setState","_instances","from","includes","push","index","indexOf","splice","_StreamingSoundInstance","_AbstractSoundInstance","sound","onReadyObservable","Observable","resolve","reject","_rejectPreloadedProimse","_resolvePreloadedPromise","onErrorObservable","value","dispose","clear","_WebAudioStreamingSound","_stereo","autoplay","maxInstances","Infinity","_subGraph","_SubGraph","_initAsync","source","audioContext","_audioContext","AudioContext","Error","_source","outBus","outBusAutoDefault","isReadyPromise","defaultMainBus","initAsync","_HasSpatialAudioOptions","_initSpatialProperty","_addSound","_inNode","_outNode","stereo","_StereoAudio","_removeSound","getClassName","_WebAudioStreamingSoundInstance","_connect","node","connect","_disconnect","disconnect","_createSpatialProperty","autoUpdate","minUpdateTime","_SpatialWebAudio","_getOptions","_WebAudioBusAndSoundSubGraph","_downstreamNodes","_owner","_upstreamNodes","_currentTimeChangedWhilePaused","_enginePlayTime","_enginePauseTime","_isReady","_isReadyPromise","_resolveIsReadyPromise","_rejectIsReadyPromise","_onCanPlayThrough","_mediaElement","notifyObservers","_onEnded","onEndedObservable","_onError","reason","_onEngineStateChanged","stateChangedObservable","_onUserGesture","_volumeNode","GainNode","_initFromUrl","isArray","_initFromUrls","HTMLMediaElement","_initFromMediaElement","currentTime","_state","timeSinceLastStart","restart","pause","startTime","_sourceNode","removeEventListener","children","removeChild","userGestureObservable","undefined","gain","_play","_stop","mediaElement","Tools","SetCorsBehavior","currentSrc","controls","preload","addEventListener","once","load","MediaElementAudioSourceNode","_sound","url","audio","Audio","_CleanUrl","urls","document","createElement","src","appendChild","result","catch","addOnce","_playWhenReady","then","Logger"],"mappings":"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"}