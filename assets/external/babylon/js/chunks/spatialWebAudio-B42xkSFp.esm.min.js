import{_ as t,a as n,b as o}from"./webAudioBaseSubGraph-BwJfROV_.esm.min.js";import{b as e,Q as i,p as s}from"./index-C7lpuH7l.esm.min.js";import{_ as a,a as r,b as h}from"./audioEngine-Dxu8PeXf.esm.min.js";const u={coneInnerAngle:6.28318530718,coneOuterAngle:6.28318530718,coneOuterVolume:0,distanceModel:"linear",maxDistance:1e4,minDistance:1,orientation:e.Right(),panningModel:"equalpower",position:e.Zero(),rolloffFactor:1,rotation:e.Zero(),rotationQuaternion:new i};function c(t){return t.spatialEnabled||void 0!==t.spatialAutoUpdate||void 0!==t.spatialConeInnerAngle||void 0!==t.spatialConeOuterAngle||void 0!==t.spatialConeOuterVolume||void 0!==t.spatialDistanceModel||void 0!==t.spatialMaxDistance||void 0!==t.spatialMinDistance||void 0!==t.spatialMinUpdateTime||void 0!==t.spatialOrientation||void 0!==t.spatialPanningModel||void 0!==t.spatialPosition||void 0!==t.spatialRolloffFactor||void 0!==t.spatialRotation||void 0!==t.spatialRotationQuaternion}class d{}const l=0;class p{}class _ extends t{constructor(t){super("Stereo",t)}setOptions(t){this.pan=t.stereoPan??l}}function m(t){return t.getSubNode("Stereo")}class g extends p{constructor(t){super(),this._pan=l,this._subGraph=t}get pan(){return this._pan}set pan(t){this._pan=t,function(t,n,o){t.callOnSubNode("Stereo",(t=>{t[n]=o}))}(this._subGraph,"pan",t)}}class N extends t{constructor(t){super("Spatial",t),this._attacherComponent=null}get isAttached(){return null!==this._attacherComponent&&this._attacherComponent.isAttached}attach(t,n,o){this.detach(),this._attacherComponent||(this._attacherComponent=new a(this)),this._attacherComponent.attach(t,n,o)}detach(){this._attacherComponent?.detach()}dispose(){super.dispose(),this._attacherComponent?.dispose(),this._attacherComponent=null}setOptions(t){this.coneInnerAngle=t.spatialConeInnerAngle??u.coneInnerAngle,this.coneOuterAngle=t.spatialConeOuterAngle??u.coneOuterAngle,this.coneOuterVolume=t.spatialConeOuterVolume??u.coneOuterVolume,this.distanceModel=t.spatialDistanceModel??u.distanceModel,this.maxDistance=t.spatialMaxDistance??u.maxDistance,this.minDistance=t.spatialMinDistance??u.minDistance,this.orientation=t.spatialOrientation??u.orientation,this.panningModel=t.spatialPanningModel??u.panningModel,this.rolloffFactor=t.spatialRolloffFactor??u.rolloffFactor,t.spatialPosition&&(this.position=t.spatialPosition.clone()),t.spatialRotationQuaternion?this.rotationQuaternion=t.spatialRotationQuaternion.clone():t.spatialRotation?this.rotation=t.spatialRotation.clone():this.rotationQuaternion=u.rotationQuaternion.clone(),this.update()}update(){this.isAttached?this._attacherComponent?.update():(this._updatePosition(),this._updateRotation())}}function f(t){return t.getSubNode("Spatial")}function A(t,n,o){t.callOnSubNode("Spatial",(t=>{t[n]=o}))}const b=s.Zero(),O=new i;function x(t){return t*Math.PI/180}function M(t){return 180*t/Math.PI}class D extends N{constructor(t){super(t),this._lastOrientation=e.Zero(),this._lastPosition=e.Zero(),this._lastRotation=e.Zero(),this._lastRotationQuaternion=new i,this.orientation=u.orientation.clone(),this.position=u.position.clone(),this.rotation=u.rotation.clone(),this.rotationQuaternion=u.rotationQuaternion.clone(),this.node=new PannerNode(t._audioContext),this._orientationX=new r(t,this.node.orientationX),this._orientationY=new r(t,this.node.orientationY),this._orientationZ=new r(t,this.node.orientationZ),this._positionX=new r(t,this.node.positionX),this._positionY=new r(t,this.node.positionY),this._positionZ=new r(t,this.node.positionZ)}dispose(){super.dispose(),this._orientationX.dispose(),this._orientationY.dispose(),this._orientationZ.dispose(),this._positionX.dispose(),this._positionY.dispose(),this._positionZ.dispose(),this.node.disconnect()}get coneInnerAngle(){return x(this.node.coneInnerAngle)}set coneInnerAngle(t){this.node.coneInnerAngle=M(t)}get coneOuterAngle(){return x(this.node.coneOuterAngle)}set coneOuterAngle(t){this.node.coneOuterAngle=M(t)}get coneOuterVolume(){return this.node.coneOuterGain}set coneOuterVolume(t){this.node.coneOuterGain=t}get distanceModel(){return this.node.distanceModel}set distanceModel(t){this.node.distanceModel=t;const n=this.node.maxDistance;this.node.maxDistance=n+.001,this.node.maxDistance=n}get minDistance(){return this.node.refDistance}set minDistance(t){this.node.refDistance=t}get maxDistance(){return this.node.maxDistance}set maxDistance(t){this.node.maxDistance=t}get panningModel(){return this.node.panningModel}set panningModel(t){this.node.panningModel=t}get rolloffFactor(){return this.node.rolloffFactor}set rolloffFactor(t){this.node.rolloffFactor=t}get _inNode(){return this.node}get _outNode(){return this.node}_updatePosition(){this._lastPosition.equalsWithEpsilon(this.position)||(this._positionX.targetValue=this.position.x,this._positionY.targetValue=this.position.y,this._positionZ.targetValue=this.position.z,this._lastPosition.copyFrom(this.position))}_updateRotation(){let t=!1;if(this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion))if(this._lastRotation.equalsWithEpsilon(this.rotation)){if(this._lastOrientation.equalsWithEpsilon(this.orientation))return}else i.FromEulerAnglesToRef(this.rotation.x,this.rotation.y,this.rotation.z,O),this._lastRotation.copyFrom(this.rotation),t=!0;else O.copyFrom(this.rotationQuaternion),this._lastRotationQuaternion.copyFrom(this.rotationQuaternion),t=!0;t&&(s.FromQuaternionToRef(O,b),e.TransformNormalToRef(e.RightReadOnly,b,this.orientation)),this._orientationX.targetValue=this.orientation.x,this._orientationY.targetValue=this.orientation.y,this._orientationZ.targetValue=this.orientation.z}_connect(t){return!!super._connect(t)&&(t._inNode&&this.node.connect(t._inNode),!0)}_disconnect(t){return!!super._disconnect(t)&&(t._inNode&&this.node.disconnect(t._inNode),!0)}getClassName(){return"_SpatialWebAudioSubNode"}}class S extends _{constructor(t){super(t),this.node=new StereoPannerNode(t._audioContext),this._pan=new r(t,this.node.pan)}dispose(){super.dispose(),this._pan.dispose()}get pan(){return this._pan.targetValue}set pan(t){this._pan.targetValue=t}get _inNode(){return this.node}get _outNode(){return this.node}getClassName(){return"_StereoWebAudioSubNode"}_connect(t){return!!super._connect(t)&&(t._inNode&&this.node.connect(t._inNode),!0)}_disconnect(t){return!!super._disconnect(t)&&(t._inNode&&this.node.disconnect(t._inNode),!0)}}class w extends n{constructor(){super(...arguments),this._rootNode=null,this._inputNode=null}async initAsync(t){await super.initAsync(t);let n=!1,o=!1;(n=c(t))&&await this.createAndAddSubNodeAsync("Spatial"),(o=function(t){return t.stereoEnabled||void 0!==t.stereoPan}(t))&&await this.createAndAddSubNodeAsync("Stereo"),await this._createSubNodePromisesResolvedAsync(),n&&f(this)?.setOptions(t),o&&m(this)?.setOptions(t)}get _inNode(){return this._inputNode}_createSubNode(t){try{return super._createSubNode(t)}catch(t){}switch(t){case"Spatial":return async function(t){return new D(t)}(this._owner.engine);case"Stereo":return async function(t){return new S(t)}(this._owner.engine);default:throw new Error(`Unknown subnode name: ${t}`)}}_onSubNodesChanged(){super._onSubNodesChanged();const t=f(this),n=m(this),e=o(this);if(t&&"_SpatialWebAudioSubNode"!==t.getClassName())throw new Error("Not a WebAudio subnode.");if(n&&"_StereoWebAudioSubNode"!==n.getClassName())throw new Error("Not a WebAudio subnode.");if(e&&"_VolumeWebAudioSubNode"!==e.getClassName())throw new Error("Not a WebAudio subnode.");t&&(t.disconnectAll(),e&&t.connect(e)),n&&(n.disconnectAll(),e&&n.connect(e)),t&&n?(this._rootNode=new GainNode(this._owner.engine._audioContext),this._rootNode.connect(t._outNode),this._rootNode.connect(n._outNode)):(this._rootNode?.disconnect(),this._rootNode=null);let i=null,s=null;if(this._rootNode?s=this._rootNode:(t?i=t:n?i=n:e&&(i=e),s=i?.node??null),this._inputNode!==s){if(this._inputNode&&this._upstreamNodes){const t=this._upstreamNodes.values();for(let n=t.next();!n.done;n=t.next())n.value._outNode?.disconnect(this._inputNode)}if(this._inputNode=s,s&&this._upstreamNodes){const t=this._upstreamNodes.values();for(let n=t.next();!n.done;n=t.next())n.value._outNode?.connect(s)}}}}class Q extends d{constructor(t){super(),this._coneInnerAngle=u.coneInnerAngle,this._coneOuterAngle=u.coneOuterAngle,this._coneOuterVolume=u.coneOuterVolume,this._distanceModel=u.distanceModel,this._maxDistance=u.maxDistance,this._minDistance=u.minDistance,this._panningModel=u.panningModel,this._rolloffFactor=u.rolloffFactor;const n=f(t);n?(this._orientation=n.orientation.clone(),this._position=n.position.clone(),this._rotation=n.rotation.clone(),this._rotationQuaternion=n.rotationQuaternion.clone()):(this._orientation=u.orientation.clone(),this._position=u.position.clone(),this._rotation=u.rotation.clone(),this._rotationQuaternion=u.rotationQuaternion.clone(),t.createAndAddSubNodeAsync("Spatial")),this._subGraph=t}dispose(){this._subGraph.removeSubNodeAsync(f(this._subGraph))}get coneInnerAngle(){return this._coneInnerAngle}set coneInnerAngle(t){this._coneInnerAngle=t,A(this._subGraph,"coneInnerAngle",t)}get coneOuterAngle(){return this._coneOuterAngle}set coneOuterAngle(t){this._coneOuterAngle=t,A(this._subGraph,"coneOuterAngle",t)}get coneOuterVolume(){return this._coneOuterVolume}set coneOuterVolume(t){this._coneOuterVolume=t,A(this._subGraph,"coneOuterVolume",t)}get distanceModel(){return this._distanceModel}set distanceModel(t){this._distanceModel=t,A(this._subGraph,"distanceModel",t)}get isAttached(){return this._subGraph.getSubNode("Spatial")?.isAttached??!1}get maxDistance(){return this._maxDistance}set maxDistance(t){t<=0&&(t=1e-6),this._maxDistance=t,A(this._subGraph,"maxDistance",t)}get minDistance(){return this._minDistance}set minDistance(t){this._minDistance=t,A(this._subGraph,"minDistance",t)}get orientation(){return this._orientation}set orientation(t){this._orientation=t,this._updateRotation()}get panningModel(){return this._panningModel}set panningModel(t){this._panningModel=t,A(this._subGraph,"panningModel",t)}get position(){return this._position}set position(t){this._position=t,this._updatePosition()}get rolloffFactor(){return this._rolloffFactor}set rolloffFactor(t){this._rolloffFactor=t,A(this._subGraph,"rolloffFactor",t)}get rotation(){return this._rotation}set rotation(t){this._rotation=t,this._updateRotation()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(t){this._rotationQuaternion=t,this._updateRotation()}attach(t,n=!1,o=3){f(this._subGraph)?.attach(t,n,o)}detach(){f(this._subGraph)?.detach()}update(){const t=f(this._subGraph);t&&(t.isAttached?t.update():(this._updatePosition(t),this._updateRotation(t)))}_updatePosition(t=null){if(!t&&!(t=f(this._subGraph)))return;t.position.equalsWithEpsilon(this._position)||(t.position.copyFrom(this._position),t._updatePosition())}_updateRotation(t=null){(t||(t=f(this._subGraph)))&&(t.rotationQuaternion.equalsWithEpsilon(this._rotationQuaternion)?t.rotation.equalsWithEpsilon(this._rotation)?t.orientation.equalsWithEpsilon(this._orientation)||(t.orientation.copyFrom(this._orientation),t._updateRotation(),this._rotation.copyFrom(t.rotation),this._rotationQuaternion.copyFrom(t.rotationQuaternion)):(t.rotation.copyFrom(this._rotation),t._updateRotation(),this._orientation.copyFrom(t.orientation),this._rotationQuaternion.copyFrom(t.rotationQuaternion)):(t.rotationQuaternion.copyFrom(this._rotationQuaternion),t._updateRotation(),this._orientation.copyFrom(t.orientation),this._rotation.copyFrom(t.rotation)))}}class F extends Q{constructor(t,n,o){super(t),this._updaterComponent=new h(this,n,o)}get minUpdateTime(){return this._updaterComponent.minUpdateTime}set minUpdateTime(t){this._updaterComponent.minUpdateTime=t}dispose(){super.dispose(),this._updaterComponent.dispose(),this._updaterComponent=null}}export{c as _,u as a,g as b,F as c,w as d};
//# sourceMappingURL=spatialWebAudio-B42xkSFp.esm.min.js.map
