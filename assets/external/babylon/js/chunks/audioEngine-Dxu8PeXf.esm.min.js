import{O as t,b as e,Q as s,L as i,aM as n,p as o,e as a,af as r}from"./index-C7lpuH7l.esm.min.js";var u;!function(t){t[t.HAS_INPUTS=1]="HAS_INPUTS",t[t.HAS_OUTPUTS=2]="HAS_OUTPUTS",t[t.HAS_INPUTS_AND_OUTPUTS=3]="HAS_INPUTS_AND_OUTPUTS"}(u||(u={}));class d{constructor(e,s){this.onDisposeObservable=new t,this.engine=e,1&s&&(this._upstreamNodes=new Set),2&s&&(this._downstreamNodes=new Set)}dispose(){if(this._downstreamNodes){for(const t of Array.from(this._downstreamNodes))if(!this._disconnect(t))throw new Error("Disconnect failed");this._downstreamNodes.clear()}if(this._upstreamNodes){for(const t of Array.from(this._upstreamNodes))if(!t._disconnect(this))throw new Error("Disconnect failed");this._upstreamNodes.clear()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()}_connect(t){return!!this._downstreamNodes&&(!this._downstreamNodes.has(t)&&(!!t._onConnect(this)&&(this._downstreamNodes.add(t),!0)))}_disconnect(t){return!!this._downstreamNodes&&(!!this._downstreamNodes.delete(t)&&t._onDisconnect(this))}_onConnect(t){return!!this._upstreamNodes&&(!this._upstreamNodes.has(t)&&(this._upstreamNodes.add(t),!0))}_onDisconnect(t){return this._upstreamNodes?.delete(t)??!1}}class h extends d{constructor(e,s,i){super(s,i),this.onNameChangedObservable=new t,this._name=e}get name(){return this._name}set name(t){if(this._name===t)return;const e=this._name;this._name=t,this.onNameChangedObservable.notifyObservers({newName:t,oldName:e,node:this})}dispose(){super.dispose(),this.onNameChangedObservable.clear()}}class l{constructor(t){this._attachmentType=3,this._position=new e,this._rotationQuaternion=new s,this._sceneNode=null,this._useBoundingBox=!1,this.dispose=()=>{this.detach()},this._spatialAudioNode=t}get isAttached(){return null!==this._sceneNode}attach(t,e,s){this._sceneNode!==t&&(this.detach(),t&&(this._attachmentType=s,this._sceneNode=t,this._sceneNode.onDisposeObservable.add(this.dispose),this._useBoundingBox=e))}detach(){this._sceneNode?.onDisposeObservable.removeCallback(this.dispose),this._sceneNode=null}update(){1&this._attachmentType&&(this._useBoundingBox&&this._sceneNode.getBoundingInfo?this._position.copyFrom(this._sceneNode.getBoundingInfo().boundingBox.centerWorld):this._sceneNode?.getWorldMatrix().getTranslationToRef(this._position),this._spatialAudioNode.position.copyFrom(this._position),this._spatialAudioNode._updatePosition()),2&this._attachmentType&&(this._sceneNode?.getWorldMatrix().decompose(void 0,this._rotationQuaternion),this._spatialAudioNode.rotationQuaternion.copyFrom(this._rotationQuaternion),this._spatialAudioNode._updateRotation())}}const _=new RegExp("\\.(\\w{3,4})($|\\?)"),m=100,c=new Float32Array([0,0]);let p=null,g=null,b=null;function A(t,e,s){let i;if(p||(p=new Float32Array(m)),"linear"===t)return c[0]=e,c[1]=s,c;if("exponential"===t)i=function(){if(!g){g=new Float32Array(m);const t=1/99;let e=t;for(let s=1;s<m;s++)g[s]=Math.exp(-11.512925464970227*(1-e)),e+=t}return g}();else{if("logarithmic"!==t)throw new Error(`Unknown ramp shape: ${t}`);i=function(){if(!b){b=new Float32Array(m);const t=.01;let e=t;for(let s=0;s<m;s++)b[s]=1+Math.log10(e)/Math.log10(m),e+=t}return b}()}const n=Math.sign(s-e),o=Math.abs(s-e);if(1===n)for(let t=0;t<i.length;t++)p[t]=e+o*i[t];else{let t=99;for(let s=0;s<i.length;s++,t--)p[s]=e-o*(1-i[t])}return p}function v(t){return t.replace(/#/gm,"%23")}let y=!0;class w{constructor(t,e){this._rampEndTime=0,this._engine=t,this._param=e,this._targetValue=e.value}get isRamping(){return this._engine.currentTime<this._rampEndTime}get targetValue(){return this._targetValue}set targetValue(t){this.setTargetValue(t)}get value(){return this._param.value}dispose(){this._param=null,this._engine=null}setTargetValue(t,e=null){if(!Number.isFinite(t))return void i.Warn(`Attempted to set audio parameter to non-finite value: ${t}`);this._param.cancelScheduledValues(0);const s="string"==typeof e?.shape?e.shape:"linear",n=this._engine.currentTime;if("none"===s)return this._param.value=this._targetValue=t,void(this._rampEndTime=n);let o="number"==typeof e?.duration?Math.max(e.duration,this._engine.parameterRampDuration):this._engine.parameterRampDuration;if(this._targetValue=t,(o=Math.max(this._engine.parameterRampDuration,o))<1e-6)this._param.setValueAtTime(t,n);else try{this._param.setValueCurveAtTime(A(s,Number.isFinite(this._param.value)?this._param.value:0,t),n,o),this._rampEndTime=n+o}catch(t){y&&(i.Warn(`Audio parameter ramping failed: ${t.message}`),y=!1)}}}class f{constructor(t,e,s){if(this._autoUpdate=!0,this._lastUpdateTime=0,this.minUpdateTime=0,!e)return;this.minUpdateTime=s;const i=()=>{if(!this._autoUpdate)return;let e=!1;if(0<this.minUpdateTime){const t=n.Now;this._lastUpdateTime&&t-this._lastUpdateTime<this.minUpdateTime&&(e=!0),this._lastUpdateTime=t}e||t.update(),requestAnimationFrame(i)};requestAnimationFrame(i)}dispose(){this._autoUpdate=!1}}class C{constructor(t){this._mainBuses=new Set,this._sounds=new Set,this._soundsArray=null,this._nodes=new Set,this._defaultMainBus=null,this._parameterRampDuration=.01,"number"==typeof t.parameterRampDuration&&(this.parameterRampDuration=t.parameterRampDuration)}get defaultMainBus(){return 0===this._mainBuses.size?null:(this._defaultMainBus||(this._defaultMainBus=Array.from(this._mainBuses)[0]),this._defaultMainBus)}get parameterRampDuration(){return this._parameterRampDuration}set parameterRampDuration(t){this._parameterRampDuration=Math.max(0,t)}get sounds(){return this._soundsArray||(this._soundsArray=Array.from(this._sounds)),this._soundsArray}dispose(){const t=this._nodes.values();for(let e=t.next();!e.done;e=t.next())e.value.dispose();this._mainBuses.clear(),this._nodes.clear(),this._sounds.clear(),this._disposeSoundsArray(),this._defaultMainBus=null}unlockAsync(){return this.resumeAsync()}_addMainBus(t){this._mainBuses.add(t),this._addNode(t)}_removeMainBus(t){this._mainBuses.delete(t),this._defaultMainBus=null,this._removeNode(t)}_addNode(t){this._nodes.add(t)}_removeNode(t){this._nodes.delete(t)}_addSound(t){this._disposeSoundsArray(),this._sounds.add(t),this._addNode(t)}_removeSound(t){this._disposeSoundsArray(),this._sounds.delete(t),this._removeNode(t)}_disposeSoundsArray(){this._soundsArray&&(this._soundsArray.length=0,this._soundsArray=null)}}const O={position:e.Zero(),rotation:e.Zero(),rotationQuaternion:new s};class U{}class x extends U{constructor(){super(),this._attacherComponent=null,this._attacherComponent=new l(this)}get isAttached(){return null!==this._attacherComponent&&this._attacherComponent.isAttached}attach(t,e=!1,s=3){this._attacherComponent||(this._attacherComponent=new l(this)),this._attacherComponent.attach(t,e,s)}detach(){this._attacherComponent?.detach()}dispose(){this._attacherComponent?.dispose(),this._attacherComponent=null}setOptions(t){void 0!==t.listenerMinUpdateTime&&(this.minUpdateTime=t.listenerMinUpdateTime),t.listenerPosition&&(this.position=t.listenerPosition.clone()),t.listenerRotationQuaternion?this.rotationQuaternion=t.listenerRotationQuaternion.clone():t.listenerRotation?this.rotation=t.listenerRotation.clone():this.rotationQuaternion=O.rotationQuaternion.clone(),this.update()}}const N=o.Zero(),S=new s,T=e.Zero(),R=e.Zero();function B(t,e,s){const i=t._audioContext.listener;return i.forwardX&&i.forwardY&&i.forwardZ&&i.positionX&&i.positionY&&i.positionZ&&i.upX&&i.upY&&i.upZ?new M(t,e,s):new I(t,e,s)}class P extends x{constructor(t,i,n){super(),this._lastPosition=e.Zero(),this._lastRotation=e.Zero(),this._lastRotationQuaternion=new s,this.position=e.Zero(),this.rotation=e.Zero(),this.rotationQuaternion=new s,this._listener=t._audioContext.listener,this.engine=t,this._updaterComponent=new f(this,i,n)}dispose(){super.dispose(),this._updaterComponent.dispose(),this._updaterComponent=null}get minUpdateTime(){return this._updaterComponent.minUpdateTime}set minUpdateTime(t){this._updaterComponent.minUpdateTime=t}update(){this.isAttached?this._attacherComponent?.update():(this._updatePosition(),this._updateRotation())}_updatePosition(){this._lastPosition.equalsWithEpsilon(this.position)||(this._setWebAudioPosition(this.position),this._lastPosition.copyFrom(this.position))}_updateRotation(){if(this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion)){if(this._lastRotation.equalsWithEpsilon(this.rotation))return;s.FromEulerAnglesToRef(this.rotation.x,this.rotation.y,this.rotation.z,S),this._lastRotation.copyFrom(this.rotation)}else S.copyFrom(this.rotationQuaternion),this._lastRotationQuaternion.copyFrom(this.rotationQuaternion);o.FromQuaternionToRef(S,N),e.TransformNormalToRef(e.RightHandedForwardReadOnly,N,T),e.TransformNormalToRef(e.Up(),N,R),this._setWebAudioOrientation(T,R)}}class M extends P{constructor(t,e,s){super(t,e,s);const i=t._audioContext.listener;this._forwardX=new w(t,i.forwardX),this._forwardY=new w(t,i.forwardY),this._forwardZ=new w(t,i.forwardZ),this._positionX=new w(t,i.positionX),this._positionY=new w(t,i.positionY),this._positionZ=new w(t,i.positionZ),this._upX=new w(t,i.upX),this._upY=new w(t,i.upY),this._upZ=new w(t,i.upZ)}_setWebAudioPosition(t){this.isAttached&&(this._positionX.isRamping||this._positionY.isRamping||this._positionZ.isRamping)||(this._positionX.targetValue=t.x,this._positionY.targetValue=t.y,this._positionZ.targetValue=t.z)}_setWebAudioOrientation(t,e){this.isAttached&&(this._forwardX.isRamping||this._forwardY.isRamping||this._forwardZ.isRamping||this._upX.isRamping||this._upY.isRamping||this._upZ.isRamping)||(this._forwardX.targetValue=t.x,this._forwardY.targetValue=t.y,this._forwardZ.targetValue=t.z,this._upX.targetValue=e.x,this._upY.targetValue=e.y,this._upZ.targetValue=e.z)}}class I extends P{_setWebAudioPosition(t){this._listener.setPosition(t.x,t.y,t.z)}_setWebAudioOrientation(t,e){this._listener.setOrientation(t.x,t.y,t.z,e.x,e.y,e.z)}}class E extends d{constructor(t){super(t,1)}}class k extends E{constructor(t){super(t),this._setGainNode(new GainNode(t._audioContext))}dispose(){super.dispose(),this._volume.dispose(),this._gainNode.disconnect(),this._destinationNode.disconnect()}get _inNode(){return this._gainNode}set _inNode(t){this._gainNode!==t&&this._setGainNode(t)}get volume(){return this._volume.targetValue}set volume(t){this._volume.targetValue=t}get _destinationNode(){return this.engine._audioDestination}getClassName(){return"_WebAudioMainOut"}setVolume(t,e=null){this._volume.setTargetValue(t,e)}_setGainNode(t){this._gainNode!==t&&(this._gainNode?.disconnect(),t.connect(this._destinationNode),this._volume=new w(this.engine,t.gain),this._gainNode=t)}}class F{constructor(t,e){this._button=null,this._enabled=!0,this._style=null,this._onStateChanged=()=>{this._button&&("running"===this._engine.state?this._hide():this._show())},this._engine=t;const s=e||a.LastCreatedEngine?.getInputElement()?.parentElement||document.body,i=(s?.offsetTop||0)+20;this._style=document.createElement("style"),this._style.appendChild(document.createTextNode(`.babylonUnmute{position:absolute;top:${i}px;margin-left:20px;height:40px;width:60px;background-color:rgba(51,51,51,0.7);background-image:url("data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E");background-size:80%;background-repeat:no-repeat;background-position:center;background-position-y:4px;border:none;outline:none;transition:transform 0.125s ease-out;cursor:pointer;z-index:9999;}.babylonUnmute:hover{transform:scale(1.05)}`)),document.head.appendChild(this._style),this._button=document.createElement("button"),this._button.className="babylonUnmute",this._button.id="babylonUnmuteButton",this._button.addEventListener("click",(()=>{this._engine.unlockAsync()})),s.appendChild(this._button),this._engine.stateChangedObservable.add(this._onStateChanged)}dispose(){this._button?.remove(),this._button=null,this._style?.remove(),this._style=null,this._engine.stateChangedObservable.removeCallback(this._onStateChanged)}get enabled(){return this._enabled}set enabled(t){this._enabled=t,t?"running"!==this._engine.state&&this._show():this._hide()}_show(){this._button&&this._enabled&&(this._button.style.display="block")}_hide(){this._button&&(this._button.style.display="none")}}const D={aac:"audio/aac",ac3:"audio/ac3",flac:"audio/flac",m4a:"audio/mp4",mp3:'audio/mpeg; codecs="mp3"',mp4:"audio/mp4",ogg:'audio/ogg; codecs="vorbis"',wav:"audio/wav",webm:'audio/webm; codecs="vorbis"'};class V extends C{constructor(e={}){super(e),this._audioContextStarted=!1,this._destinationNode=null,this._invalidFormats=new Set,this._isUpdating=!1,this._listener=null,this._listenerAutoUpdate=!0,this._listenerMinUpdateTime=0,this._pauseCalled=!1,this._resumeOnInteraction=!0,this._resumeOnPause=!0,this._resumeOnPauseRetryInterval=1e3,this._resumeOnPauseTimerId=null,this._resumePromise=null,this._silentHtmlAudio=null,this._unmuteUI=null,this._updateObservable=null,this._validFormats=new Set,this._volume=1,this._isUsingOfflineAudioContext=!1,this.isReadyPromise=new Promise((t=>{this._resolveIsReadyPromise=t})),this.stateChangedObservable=new t,this.userGestureObservable=new t,this._initAudioContextAsync=async()=>{this._audioContext.addEventListener("statechange",this._onAudioContextStateChange),this._mainOut=new k(this),this._mainOut.volume=this._volume,await this.createMainBusAsync("default")},this._onAudioContextStateChange=()=>{"running"===this.state&&(clearInterval(this._resumeOnPauseTimerId),this._audioContextStarted=!0,this._resumePromise=null),"suspended"!==this.state&&"interrupted"!==this.state||this._audioContextStarted&&this._resumeOnPause&&!this._pauseCalled&&(clearInterval(this._resumeOnPauseTimerId),this._resumeOnPauseTimerId=setInterval((()=>{this.resumeAsync()}),this._resumeOnPauseRetryInterval)),this.stateChangedObservable.notifyObservers(this.state)},this._onUserGestureAsync=async()=>{if(this._resumeOnInteraction&&await this._audioContext.resume(),!this._silentHtmlAudio){this._silentHtmlAudio=document.createElement("audio");const t=this._silentHtmlAudio;t.controls=!1,t.preload="auto",t.loop=!0,t.src="data:audio/wav;base64,UklGRjAAAABXQVZFZm10IBAAAAABAAEAgLsAAAB3AQACABAAZGF0YQwAAAAAAAEA/v8CAP//AQA=",t.play()}this.userGestureObservable.notifyObservers()},this._startUpdating=()=>{if(!this._isUpdating)if(this._isUpdating=!0,"running"===this.state)this._update();else{const t=()=>{"running"===this.state&&(this._update(),this.stateChangedObservable.removeCallback(t))};this.stateChangedObservable.add(t)}},this._update=()=>{this._updateObservable?.hasObservers()?(this._updateObservable.notifyObservers(),requestAnimationFrame(this._update)):this._isUpdating=!1},"boolean"==typeof e.listenerAutoUpdate&&(this._listenerAutoUpdate=e.listenerAutoUpdate),"number"==typeof e.listenerMinUpdateTime&&(this._listenerMinUpdateTime=e.listenerMinUpdateTime),this._volume=e.volume??1,e.audioContext?(this._isUsingOfflineAudioContext=e.audioContext instanceof OfflineAudioContext,this._audioContext=e.audioContext):this._audioContext=new AudioContext,e.disableDefaultUI||(this._unmuteUI=new F(this,e.defaultUIParentElement))}async _initAsync(t){this._resumeOnInteraction="boolean"!=typeof t.resumeOnInteraction||t.resumeOnInteraction,this._resumeOnPause="boolean"!=typeof t.resumeOnPause||t.resumeOnPause,this._resumeOnPauseRetryInterval=t.resumeOnPauseRetryInterval??1e3,document.addEventListener("click",this._onUserGestureAsync),await this._initAudioContextAsync(),function(t){return t.listenerEnabled||void 0!==t.listenerMinUpdateTime||void 0!==t.listenerPosition||void 0!==t.listenerRotation||void 0!==t.listenerRotationQuaternion}(t)&&(this._listener=B(this,this._listenerAutoUpdate,this._listenerMinUpdateTime),this._listener.setOptions(t)),this._resolveIsReadyPromise()}get currentTime(){return this._audioContext.currentTime??0}get _inNode(){return this._audioContext.destination}get mainOut(){return this._mainOut}get listener(){return this._listener??(this._listener=B(this,this._listenerAutoUpdate,this._listenerMinUpdateTime))}get state(){return this._isUsingOfflineAudioContext?"running":this._audioContext.state}get volume(){return this._volume}set volume(t){this._volume!==t&&(this._volume=t,this._mainOut&&(this._mainOut.volume=t))}get _audioDestination(){return this._destinationNode?this._destinationNode:this._destinationNode=this._audioContext.destination}set _audioDestination(t){this._destinationNode=t}get _unmuteUIEnabled(){return!!this._unmuteUI&&this._unmuteUI.enabled}set _unmuteUIEnabled(t){this._unmuteUI&&(this._unmuteUI.enabled=t)}async createBusAsync(t,e={}){const s=new((await import("./webAudioBus-SC4wRoJm.esm.min.js"))._WebAudioBus)(t,this,e);return await s._initAsync(e),s}async createMainBusAsync(t,e={}){const s=new((await import("./webAudioMainBus-CWbH03BC.esm.min.js"))._WebAudioMainBus)(t,this);return await s._initAsync(e),s}async createMicrophoneSoundSourceAsync(t,e){let s;try{s=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(t){throw new Error("Unable to access microphone: "+t)}return await this.createSoundSourceAsync(t,new MediaStreamAudioSourceNode(this._audioContext,{mediaStream:s}),{outBusAutoDefault:!1,...e})}async createSoundAsync(t,e,s={}){const i=new((await import("./webAudioStaticSound-B63zkTsc.esm.min.js"))._WebAudioStaticSound)(t,this,s);return await i._initAsync(e,s),i}async createSoundBufferAsync(t,e={}){const s=new((await import("./webAudioStaticSound-B63zkTsc.esm.min.js"))._WebAudioStaticSoundBuffer)(this);return await s._initAsync(t,e),s}async createSoundSourceAsync(t,e,s={}){const i=new((await import("./webAudioSoundSource-9d69uvKb.esm.min.js"))._WebAudioSoundSource)(t,e,this,s);return await i._initAsync(s),i}async createStreamingSoundAsync(t,e,s={}){const i=new((await import("./webAudioStreamingSound-Bb02H5Tl.esm.min.js"))._WebAudioStreamingSound)(t,this,s);return await i._initAsync(e,s),i}dispose(){super.dispose(),this._listener?.dispose(),this._listener=null,"closed"===this._audioContext.state||this._isUsingOfflineAudioContext||this._audioContext.close(),document.removeEventListener("click",this._onUserGestureAsync),this._audioContext.removeEventListener("statechange",this._onAudioContextStateChange),this._silentHtmlAudio?.remove(),this._updateObservable?.clear(),this._updateObservable=null,this._unmuteUI?.dispose(),this._unmuteUI=null,this.stateChangedObservable.clear()}flagInvalidFormat(t){this._invalidFormats.add(t)}isFormatValid(t){if(this._validFormats.has(t))return!0;if(this._invalidFormats.has(t))return!1;const e=D[t];if(void 0===e)return!1;return""===(new Audio).canPlayType(e)?(this._invalidFormats.add(t),!1):(this._validFormats.add(t),!0)}async pauseAsync(){await this._audioContext.suspend(),this._pauseCalled=!0}resumeAsync(){return this._pauseCalled=!1,this._resumePromise||(this._resumePromise=this._audioContext.resume(),this.stateChangedObservable.notifyObservers(this.state)),this._resumePromise}setVolume(t,e=null){if(!this._mainOut)throw new Error("Main output not initialized yet.");this._mainOut.setVolume(t,e)}_addMainBus(t){super._addMainBus(t)}_removeMainBus(t){super._removeMainBus(t)}_addNode(t){super._addNode(t)}_removeNode(t){super._removeNode(t)}_addSound(t){super._addSound(t)}_removeSound(t){super._removeSound(t)}_addUpdateObserver(e){this._updateObservable||(this._updateObservable=new t),this._updateObservable.add(e),this._startUpdating()}_removeUpdateObserver(t){this._updateObservable&&this._updateObservable.removeCallback(t)}}r.AudioEngineFactory=(t,e,s)=>new G(t,e,s);class G{get masterGain(){return this._masterGain}set masterGain(t){this._masterGain=this._v2.mainOut._inNode=t}get useCustomUnlockedButton(){return this._useCustomUnlockedButton}set useCustomUnlockedButton(t){this._useCustomUnlockedButton=t,this._v2._unmuteUIEnabled=!t}get audioContext(){return"running"===this._v2.state&&this._triggerRunningStateAsync(),this._v2._audioContext}constructor(e=null,s=null,i=null){this._tryToRun=!1,this._useCustomUnlockedButton=!1,this.canUseWebAudio=!0,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.onAudioUnlockedObservable=new t,this.onAudioLockedObservable=new t;const n=new V({audioContext:s||void 0,defaultUIParentElement:e?.parentElement?e.parentElement:void 0});n._unmuteUIEnabled=!1,this._masterGain=new GainNode(n._audioContext),n._audioDestination=i,n.stateChangedObservable.add((t=>{"running"===t?(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)):(this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this))})),n._initAsync({resumeOnInteraction:!1}).then((()=>{const t=n.defaultMainBus._outNode;t&&(t.disconnect(n.mainOut._inNode),t.connect(this._masterGain)),n.mainOut._inNode=this._masterGain,n.stateChangedObservable.notifyObservers(n.state)})),this.isMP3supported=n.isFormatValid("mp3"),this.isOGGsupported=n.isFormatValid("ogg"),this._v2=n}lock(){this._v2._audioContext.suspend(),this._useCustomUnlockedButton||(this._v2._unmuteUIEnabled=!0)}unlock(){"running"!==this._v2._audioContext?.state?this._triggerRunningStateAsync():this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))}_resumeAudioContextOnStateChange(){this._v2._audioContext?.addEventListener("statechange",(()=>{this.unlocked&&"running"!==this._v2._audioContext?.state&&this._resumeAudioContextAsync()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContextAsync(){return this._v2._isUsingOfflineAudioContext?Promise.resolve():("suspended"!==this._v2._audioContext.state||this._useCustomUnlockedButton||(this._v2._unmuteUIEnabled=!0),this._v2._audioContext.resume())}dispose(){this._v2.dispose(),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.masterGain.gain.value}setGlobalVolume(t){this.masterGain.gain.value=t}connectToAnalyser(t){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=t,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._v2._audioContext.destination)}async _triggerRunningStateAsync(){this._tryToRun?this._v2._audioContext.resume():(this._tryToRun=!0,await this._resumeAudioContextAsync(),this._tryToRun=!1,this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this))}}export{h as A,l as _,w as a,f as b,v as c,_ as d,d as e};
//# sourceMappingURL=audioEngine-Dxu8PeXf.esm.min.js.map
