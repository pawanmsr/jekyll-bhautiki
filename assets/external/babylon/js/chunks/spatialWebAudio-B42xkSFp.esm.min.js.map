{"version":3,"file":"spatialWebAudio-B42xkSFp.esm.min.js","sources":["../../../../../dev/core/dist/AudioV2/abstractAudio/subProperties/abstractSpatialAudio.js","../../../../../dev/core/dist/AudioV2/abstractAudio/subProperties/abstractStereoAudio.js","../../../../../dev/core/dist/AudioV2/abstractAudio/subNodes/stereoAudioSubNode.js","../../../../../dev/core/dist/AudioV2/abstractAudio/subProperties/stereoAudio.js","../../../../../dev/core/dist/AudioV2/abstractAudio/subNodes/spatialAudioSubNode.js","../../../../../dev/core/dist/AudioV2/webAudio/subNodes/spatialWebAudioSubNode.js","../../../../../dev/core/dist/AudioV2/webAudio/subNodes/stereoWebAudioSubNode.js","../../../../../dev/core/dist/AudioV2/webAudio/subNodes/webAudioBusAndSoundSubGraph.js","../../../../../dev/core/dist/AudioV2/abstractAudio/subProperties/spatialAudio.js","../../../../../dev/core/dist/AudioV2/webAudio/subProperties/spatialWebAudio.js"],"sourcesContent":["import { Quaternion, Vector3 } from \"../../../Maths/math.vector\";\nexport const _SpatialAudioDefaults = {\n    coneInnerAngle: 6.28318530718,\n    coneOuterAngle: 6.28318530718,\n    coneOuterVolume: 0,\n    distanceModel: \"linear\",\n    maxDistance: 10000,\n    minDistance: 1,\n    orientation: Vector3.Right(),\n    panningModel: \"equalpower\",\n    position: Vector3.Zero(),\n    rolloffFactor: 1,\n    rotation: Vector3.Zero(),\n    rotationQuaternion: new Quaternion(),\n};\n/**\n * @param options The spatial audio options to check.\n * @returns `true` if spatial audio options are defined, otherwise `false`.\n */\nexport function _HasSpatialAudioOptions(options) {\n    return (options.spatialEnabled ||\n        options.spatialAutoUpdate !== undefined ||\n        options.spatialConeInnerAngle !== undefined ||\n        options.spatialConeOuterAngle !== undefined ||\n        options.spatialConeOuterVolume !== undefined ||\n        options.spatialDistanceModel !== undefined ||\n        options.spatialMaxDistance !== undefined ||\n        options.spatialMinDistance !== undefined ||\n        options.spatialMinUpdateTime !== undefined ||\n        options.spatialOrientation !== undefined ||\n        options.spatialPanningModel !== undefined ||\n        options.spatialPosition !== undefined ||\n        options.spatialRolloffFactor !== undefined ||\n        options.spatialRotation !== undefined ||\n        options.spatialRotationQuaternion !== undefined);\n}\n/**\n * Abstract class representing the `spatial` audio property on a sound or audio bus.\n *\n * @see {@link AudioEngineV2.listener}\n */\nexport class AbstractSpatialAudio {\n}\n//# sourceMappingURL=abstractSpatialAudio.js.map","export const _StereoAudioDefaults = {\n    pan: 0,\n};\n/**\n * @param options The stereo audio options to check.\n * @returns `true` if stereo audio options are defined, otherwise `false`.\n */\nexport function _HasStereoAudioOptions(options) {\n    return options.stereoEnabled || options.stereoPan !== undefined;\n}\n/**\n * Abstract class representing the `stereo` audio property on a sound or audio bus.\n *\n * @see {@link AudioEngineV2.listener}\n */\nexport class AbstractStereoAudio {\n}\n//# sourceMappingURL=abstractStereoAudio.js.map","import { _AbstractAudioSubNode } from \"../../abstractAudio/subNodes/abstractAudioSubNode\";\nimport { _StereoAudioDefaults } from \"../../abstractAudio/subProperties/abstractStereoAudio\";\n/** @internal */\nexport class _StereoAudioSubNode extends _AbstractAudioSubNode {\n    constructor(engine) {\n        super(\"Stereo\" /* AudioSubNode.STEREO */, engine);\n    }\n    /** @internal */\n    setOptions(options) {\n        this.pan = options.stereoPan ?? _StereoAudioDefaults.pan;\n    }\n}\n/** @internal */\nexport function _GetStereoAudioSubNode(subGraph) {\n    return subGraph.getSubNode(\"Stereo\" /* AudioSubNode.STEREO */);\n}\n/** @internal */\nexport function _SetStereoAudioProperty(subGraph, property, value) {\n    subGraph.callOnSubNode(\"Stereo\" /* AudioSubNode.STEREO */, (node) => {\n        node[property] = value;\n    });\n}\n//# sourceMappingURL=stereoAudioSubNode.js.map","import { _StereoAudioDefaults, AbstractStereoAudio } from \"../../abstractAudio/subProperties/abstractStereoAudio\";\nimport { _SetStereoAudioProperty } from \"../subNodes/stereoAudioSubNode\";\n/** @internal */\nexport class _StereoAudio extends AbstractStereoAudio {\n    /** @internal */\n    constructor(subGraph) {\n        super();\n        this._pan = _StereoAudioDefaults.pan;\n        this._subGraph = subGraph;\n    }\n    /** @internal */\n    get pan() {\n        return this._pan;\n    }\n    set pan(value) {\n        this._pan = value;\n        _SetStereoAudioProperty(this._subGraph, \"pan\", value);\n    }\n}\n//# sourceMappingURL=stereoAudio.js.map","import { _SpatialAudioAttacherComponent } from \"../components/spatialAudioAttacherComponent\";\nimport { _SpatialAudioDefaults } from \"../subProperties/abstractSpatialAudio\";\nimport { _AbstractAudioSubNode } from \"./abstractAudioSubNode\";\n/** @internal */\nexport class _SpatialAudioSubNode extends _AbstractAudioSubNode {\n    constructor(engine) {\n        super(\"Spatial\" /* AudioSubNode.SPATIAL */, engine);\n        this._attacherComponent = null;\n    }\n    /** @internal */\n    get isAttached() {\n        return this._attacherComponent !== null && this._attacherComponent.isAttached;\n    }\n    /** @internal */\n    attach(sceneNode, useBoundingBox, attachmentType) {\n        this.detach();\n        if (!this._attacherComponent) {\n            this._attacherComponent = new _SpatialAudioAttacherComponent(this);\n        }\n        this._attacherComponent.attach(sceneNode, useBoundingBox, attachmentType);\n    }\n    /** @internal */\n    detach() {\n        this._attacherComponent?.detach();\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._attacherComponent?.dispose();\n        this._attacherComponent = null;\n    }\n    /** @internal */\n    setOptions(options) {\n        this.coneInnerAngle = options.spatialConeInnerAngle ?? _SpatialAudioDefaults.coneInnerAngle;\n        this.coneOuterAngle = options.spatialConeOuterAngle ?? _SpatialAudioDefaults.coneOuterAngle;\n        this.coneOuterVolume = options.spatialConeOuterVolume ?? _SpatialAudioDefaults.coneOuterVolume;\n        this.distanceModel = options.spatialDistanceModel ?? _SpatialAudioDefaults.distanceModel;\n        this.maxDistance = options.spatialMaxDistance ?? _SpatialAudioDefaults.maxDistance;\n        this.minDistance = options.spatialMinDistance ?? _SpatialAudioDefaults.minDistance;\n        this.orientation = options.spatialOrientation ?? _SpatialAudioDefaults.orientation;\n        this.panningModel = options.spatialPanningModel ?? _SpatialAudioDefaults.panningModel;\n        this.rolloffFactor = options.spatialRolloffFactor ?? _SpatialAudioDefaults.rolloffFactor;\n        if (options.spatialPosition) {\n            this.position = options.spatialPosition.clone();\n        }\n        if (options.spatialRotationQuaternion) {\n            this.rotationQuaternion = options.spatialRotationQuaternion.clone();\n        }\n        else if (options.spatialRotation) {\n            this.rotation = options.spatialRotation.clone();\n        }\n        else {\n            this.rotationQuaternion = _SpatialAudioDefaults.rotationQuaternion.clone();\n        }\n        this.update();\n    }\n    /** @internal */\n    update() {\n        if (this.isAttached) {\n            this._attacherComponent?.update();\n        }\n        else {\n            this._updatePosition();\n            this._updateRotation();\n        }\n    }\n}\n/** @internal */\nexport function _GetSpatialAudioSubNode(subGraph) {\n    return subGraph.getSubNode(\"Spatial\" /* AudioSubNode.SPATIAL */);\n}\n/** @internal */\nexport function _SetSpatialAudioProperty(subGraph, property, value) {\n    subGraph.callOnSubNode(\"Spatial\" /* AudioSubNode.SPATIAL */, (node) => {\n        node[property] = value;\n    });\n}\n//# sourceMappingURL=spatialAudioSubNode.js.map","import { Matrix, Quaternion, Vector3 } from \"../../../Maths/math.vector\";\nimport { _SpatialAudioSubNode } from \"../../abstractAudio/subNodes/spatialAudioSubNode\";\nimport { _SpatialAudioDefaults } from \"../../abstractAudio/subProperties/abstractSpatialAudio\";\nimport { _WebAudioParameterComponent } from \"../components/webAudioParameterComponent\";\nconst TmpMatrix = Matrix.Zero();\nconst TmpQuaternion = new Quaternion();\nfunction D2r(degrees) {\n    return (degrees * Math.PI) / 180;\n}\nfunction R2d(radians) {\n    return (radians * 180) / Math.PI;\n}\n/** @internal */\n// eslint-disable-next-line @typescript-eslint/require-await\nexport async function _CreateSpatialAudioSubNodeAsync(engine) {\n    return new _SpatialWebAudioSubNode(engine);\n}\n/** @internal */\nexport class _SpatialWebAudioSubNode extends _SpatialAudioSubNode {\n    /** @internal */\n    constructor(engine) {\n        super(engine);\n        this._lastOrientation = Vector3.Zero();\n        this._lastPosition = Vector3.Zero();\n        this._lastRotation = Vector3.Zero();\n        this._lastRotationQuaternion = new Quaternion();\n        /** @internal */\n        this.orientation = _SpatialAudioDefaults.orientation.clone();\n        /** @internal */\n        this.position = _SpatialAudioDefaults.position.clone();\n        /** @internal */\n        this.rotation = _SpatialAudioDefaults.rotation.clone();\n        /** @internal */\n        this.rotationQuaternion = _SpatialAudioDefaults.rotationQuaternion.clone();\n        this.node = new PannerNode(engine._audioContext);\n        this._orientationX = new _WebAudioParameterComponent(engine, this.node.orientationX);\n        this._orientationY = new _WebAudioParameterComponent(engine, this.node.orientationY);\n        this._orientationZ = new _WebAudioParameterComponent(engine, this.node.orientationZ);\n        this._positionX = new _WebAudioParameterComponent(engine, this.node.positionX);\n        this._positionY = new _WebAudioParameterComponent(engine, this.node.positionY);\n        this._positionZ = new _WebAudioParameterComponent(engine, this.node.positionZ);\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._orientationX.dispose();\n        this._orientationY.dispose();\n        this._orientationZ.dispose();\n        this._positionX.dispose();\n        this._positionY.dispose();\n        this._positionZ.dispose();\n        this.node.disconnect();\n    }\n    /** @internal */\n    get coneInnerAngle() {\n        return D2r(this.node.coneInnerAngle);\n    }\n    set coneInnerAngle(value) {\n        this.node.coneInnerAngle = R2d(value);\n    }\n    /** @internal */\n    get coneOuterAngle() {\n        return D2r(this.node.coneOuterAngle);\n    }\n    set coneOuterAngle(value) {\n        this.node.coneOuterAngle = R2d(value);\n    }\n    /** @internal */\n    get coneOuterVolume() {\n        return this.node.coneOuterGain;\n    }\n    set coneOuterVolume(value) {\n        this.node.coneOuterGain = value;\n    }\n    /** @internal */\n    get distanceModel() {\n        return this.node.distanceModel;\n    }\n    set distanceModel(value) {\n        this.node.distanceModel = value;\n        // Wiggle the max distance to make the change take effect.\n        const maxDistance = this.node.maxDistance;\n        this.node.maxDistance = maxDistance + 0.001;\n        this.node.maxDistance = maxDistance;\n    }\n    /** @internal */\n    get minDistance() {\n        return this.node.refDistance;\n    }\n    set minDistance(value) {\n        this.node.refDistance = value;\n    }\n    /** @internal */\n    get maxDistance() {\n        return this.node.maxDistance;\n    }\n    set maxDistance(value) {\n        this.node.maxDistance = value;\n    }\n    /** @internal */\n    get panningModel() {\n        return this.node.panningModel;\n    }\n    set panningModel(value) {\n        this.node.panningModel = value;\n    }\n    /** @internal */\n    get rolloffFactor() {\n        return this.node.rolloffFactor;\n    }\n    set rolloffFactor(value) {\n        this.node.rolloffFactor = value;\n    }\n    /** @internal */\n    get _inNode() {\n        return this.node;\n    }\n    /** @internal */\n    get _outNode() {\n        return this.node;\n    }\n    /** @internal */\n    _updatePosition() {\n        if (this._lastPosition.equalsWithEpsilon(this.position)) {\n            return;\n        }\n        this._positionX.targetValue = this.position.x;\n        this._positionY.targetValue = this.position.y;\n        this._positionZ.targetValue = this.position.z;\n        this._lastPosition.copyFrom(this.position);\n    }\n    /** @internal */\n    _updateRotation() {\n        let rotated = false;\n        if (!this._lastRotationQuaternion.equalsWithEpsilon(this.rotationQuaternion)) {\n            TmpQuaternion.copyFrom(this.rotationQuaternion);\n            this._lastRotationQuaternion.copyFrom(this.rotationQuaternion);\n            rotated = true;\n        }\n        else if (!this._lastRotation.equalsWithEpsilon(this.rotation)) {\n            Quaternion.FromEulerAnglesToRef(this.rotation.x, this.rotation.y, this.rotation.z, TmpQuaternion);\n            this._lastRotation.copyFrom(this.rotation);\n            rotated = true;\n        }\n        else if (this._lastOrientation.equalsWithEpsilon(this.orientation)) {\n            return;\n        }\n        if (rotated) {\n            Matrix.FromQuaternionToRef(TmpQuaternion, TmpMatrix);\n            Vector3.TransformNormalToRef(Vector3.RightReadOnly, TmpMatrix, this.orientation);\n        }\n        this._orientationX.targetValue = this.orientation.x;\n        this._orientationY.targetValue = this.orientation.y;\n        this._orientationZ.targetValue = this.orientation.z;\n    }\n    _connect(node) {\n        const connected = super._connect(node);\n        if (!connected) {\n            return false;\n        }\n        // If the wrapped node is not available now, it will be connected later by the subgraph.\n        if (node._inNode) {\n            this.node.connect(node._inNode);\n        }\n        return true;\n    }\n    _disconnect(node) {\n        const disconnected = super._disconnect(node);\n        if (!disconnected) {\n            return false;\n        }\n        if (node._inNode) {\n            this.node.disconnect(node._inNode);\n        }\n        return true;\n    }\n    /** @internal */\n    getClassName() {\n        return \"_SpatialWebAudioSubNode\";\n    }\n}\n//# sourceMappingURL=spatialWebAudioSubNode.js.map","import { _StereoAudioSubNode } from \"../../abstractAudio/subNodes/stereoAudioSubNode\";\nimport { _WebAudioParameterComponent } from \"../components/webAudioParameterComponent\";\n/** @internal */\n// eslint-disable-next-line @typescript-eslint/require-await\nexport async function _CreateStereoAudioSubNodeAsync(engine) {\n    return new _StereoWebAudioSubNode(engine);\n}\n/** @internal */\nexport class _StereoWebAudioSubNode extends _StereoAudioSubNode {\n    /** @internal */\n    constructor(engine) {\n        super(engine);\n        this.node = new StereoPannerNode(engine._audioContext);\n        this._pan = new _WebAudioParameterComponent(engine, this.node.pan);\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._pan.dispose();\n    }\n    /** @internal */\n    get pan() {\n        return this._pan.targetValue;\n    }\n    /** @internal */\n    set pan(value) {\n        this._pan.targetValue = value;\n    }\n    /** @internal */\n    get _inNode() {\n        return this.node;\n    }\n    /** @internal */\n    get _outNode() {\n        return this.node;\n    }\n    /** @internal */\n    getClassName() {\n        return \"_StereoWebAudioSubNode\";\n    }\n    _connect(node) {\n        const connected = super._connect(node);\n        if (!connected) {\n            return false;\n        }\n        // If the wrapped node is not available now, it will be connected later by the subgraph.\n        if (node._inNode) {\n            this.node.connect(node._inNode);\n        }\n        return true;\n    }\n    _disconnect(node) {\n        const disconnected = super._disconnect(node);\n        if (!disconnected) {\n            return false;\n        }\n        if (node._inNode) {\n            this.node.disconnect(node._inNode);\n        }\n        return true;\n    }\n}\n//# sourceMappingURL=stereoWebAudioSubNode.js.map","import { _GetSpatialAudioSubNode } from \"../../abstractAudio/subNodes/spatialAudioSubNode\";\nimport { _GetStereoAudioSubNode } from \"../../abstractAudio/subNodes/stereoAudioSubNode\";\nimport { _GetVolumeAudioSubNode } from \"../../abstractAudio/subNodes/volumeAudioSubNode\";\nimport { _HasSpatialAudioOptions } from \"../../abstractAudio/subProperties/abstractSpatialAudio\";\nimport { _HasStereoAudioOptions } from \"../../abstractAudio/subProperties/abstractStereoAudio\";\nimport { _CreateSpatialAudioSubNodeAsync } from \"./spatialWebAudioSubNode\";\nimport { _CreateStereoAudioSubNodeAsync } from \"./stereoWebAudioSubNode\";\nimport { _WebAudioBaseSubGraph } from \"./webAudioBaseSubGraph\";\n/** @internal */\nexport class _WebAudioBusAndSoundSubGraph extends _WebAudioBaseSubGraph {\n    constructor() {\n        super(...arguments);\n        this._rootNode = null;\n        this._inputNode = null;\n    }\n    /** @internal */\n    async initAsync(options) {\n        await super.initAsync(options);\n        let hasSpatialOptions = false;\n        let hasStereoOptions = false;\n        if ((hasSpatialOptions = _HasSpatialAudioOptions(options))) {\n            await this.createAndAddSubNodeAsync(\"Spatial\" /* AudioSubNode.SPATIAL */);\n        }\n        if ((hasStereoOptions = _HasStereoAudioOptions(options))) {\n            await this.createAndAddSubNodeAsync(\"Stereo\" /* AudioSubNode.STEREO */);\n        }\n        await this._createSubNodePromisesResolvedAsync();\n        if (hasSpatialOptions) {\n            _GetSpatialAudioSubNode(this)?.setOptions(options);\n        }\n        if (hasStereoOptions) {\n            _GetStereoAudioSubNode(this)?.setOptions(options);\n        }\n    }\n    /** @internal */\n    get _inNode() {\n        return this._inputNode;\n    }\n    // eslint-disable-next-line @typescript-eslint/promise-function-async\n    _createSubNode(name) {\n        try {\n            const node = super._createSubNode(name);\n            return node;\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        }\n        catch (e) { }\n        switch (name) {\n            case \"Spatial\" /* AudioSubNode.SPATIAL */:\n                return _CreateSpatialAudioSubNodeAsync(this._owner.engine);\n            case \"Stereo\" /* AudioSubNode.STEREO */:\n                return _CreateStereoAudioSubNodeAsync(this._owner.engine);\n            default:\n                throw new Error(`Unknown subnode name: ${name}`);\n        }\n    }\n    _onSubNodesChanged() {\n        super._onSubNodesChanged();\n        const spatialNode = _GetSpatialAudioSubNode(this);\n        const stereoNode = _GetStereoAudioSubNode(this);\n        const volumeNode = _GetVolumeAudioSubNode(this);\n        if (spatialNode && spatialNode.getClassName() !== \"_SpatialWebAudioSubNode\") {\n            throw new Error(\"Not a WebAudio subnode.\");\n        }\n        if (stereoNode && stereoNode.getClassName() !== \"_StereoWebAudioSubNode\") {\n            throw new Error(\"Not a WebAudio subnode.\");\n        }\n        if (volumeNode && volumeNode.getClassName() !== \"_VolumeWebAudioSubNode\") {\n            throw new Error(\"Not a WebAudio subnode.\");\n        }\n        if (spatialNode) {\n            spatialNode.disconnectAll();\n            if (volumeNode) {\n                spatialNode.connect(volumeNode);\n            }\n        }\n        if (stereoNode) {\n            stereoNode.disconnectAll();\n            if (volumeNode) {\n                stereoNode.connect(volumeNode);\n            }\n        }\n        if (spatialNode && stereoNode) {\n            this._rootNode = new GainNode(this._owner.engine._audioContext);\n            this._rootNode.connect(spatialNode._outNode);\n            this._rootNode.connect(stereoNode._outNode);\n        }\n        else {\n            this._rootNode?.disconnect();\n            this._rootNode = null;\n        }\n        let inSubNode = null;\n        let inNode = null;\n        if (this._rootNode) {\n            inNode = this._rootNode;\n        }\n        else {\n            if (spatialNode) {\n                inSubNode = spatialNode;\n            }\n            else if (stereoNode) {\n                inSubNode = stereoNode;\n            }\n            else if (volumeNode) {\n                inSubNode = volumeNode;\n            }\n            inNode = inSubNode?.node ?? null;\n        }\n        if (this._inputNode !== inNode) {\n            // Disconnect the wrapped upstream WebAudio nodes from the old wrapped WebAudio node.\n            // The wrapper nodes are unaware of this change.\n            if (this._inputNode && this._upstreamNodes) {\n                const it = this._upstreamNodes.values();\n                for (let next = it.next(); !next.done; next = it.next()) {\n                    next.value._outNode?.disconnect(this._inputNode);\n                }\n            }\n            this._inputNode = inNode;\n            // Connect the wrapped upstream WebAudio nodes to the new wrapped WebAudio node.\n            // The wrapper nodes are unaware of this change.\n            if (inNode && this._upstreamNodes) {\n                const it = this._upstreamNodes.values();\n                for (let next = it.next(); !next.done; next = it.next()) {\n                    next.value._outNode?.connect(inNode);\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=webAudioBusAndSoundSubGraph.js.map","import { _GetSpatialAudioSubNode, _SetSpatialAudioProperty } from \"../subNodes/spatialAudioSubNode\";\nimport { _SpatialAudioDefaults, AbstractSpatialAudio } from \"./abstractSpatialAudio\";\n/** @internal */\nexport class _SpatialAudio extends AbstractSpatialAudio {\n    /** @internal */\n    constructor(subGraph) {\n        super();\n        this._coneInnerAngle = _SpatialAudioDefaults.coneInnerAngle;\n        this._coneOuterAngle = _SpatialAudioDefaults.coneOuterAngle;\n        this._coneOuterVolume = _SpatialAudioDefaults.coneOuterVolume;\n        this._distanceModel = _SpatialAudioDefaults.distanceModel;\n        this._maxDistance = _SpatialAudioDefaults.maxDistance;\n        this._minDistance = _SpatialAudioDefaults.minDistance;\n        this._panningModel = _SpatialAudioDefaults.panningModel;\n        this._rolloffFactor = _SpatialAudioDefaults.rolloffFactor;\n        const subNode = _GetSpatialAudioSubNode(subGraph);\n        if (subNode) {\n            this._orientation = subNode.orientation.clone();\n            this._position = subNode.position.clone();\n            this._rotation = subNode.rotation.clone();\n            this._rotationQuaternion = subNode.rotationQuaternion.clone();\n        }\n        else {\n            this._orientation = _SpatialAudioDefaults.orientation.clone();\n            this._position = _SpatialAudioDefaults.position.clone();\n            this._rotation = _SpatialAudioDefaults.rotation.clone();\n            this._rotationQuaternion = _SpatialAudioDefaults.rotationQuaternion.clone();\n            // eslint-disable-next-line @typescript-eslint/no-floating-promises\n            subGraph.createAndAddSubNodeAsync(\"Spatial\" /* AudioSubNode.SPATIAL */);\n        }\n        this._subGraph = subGraph;\n    }\n    /** @internal */\n    dispose() {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        this._subGraph.removeSubNodeAsync(_GetSpatialAudioSubNode(this._subGraph));\n    }\n    /** @internal */\n    get coneInnerAngle() {\n        return this._coneInnerAngle;\n    }\n    set coneInnerAngle(value) {\n        this._coneInnerAngle = value;\n        _SetSpatialAudioProperty(this._subGraph, \"coneInnerAngle\", value);\n    }\n    /** @internal */\n    get coneOuterAngle() {\n        return this._coneOuterAngle;\n    }\n    set coneOuterAngle(value) {\n        this._coneOuterAngle = value;\n        _SetSpatialAudioProperty(this._subGraph, \"coneOuterAngle\", value);\n    }\n    /** @internal */\n    get coneOuterVolume() {\n        return this._coneOuterVolume;\n    }\n    set coneOuterVolume(value) {\n        this._coneOuterVolume = value;\n        _SetSpatialAudioProperty(this._subGraph, \"coneOuterVolume\", value);\n    }\n    /** @internal */\n    get distanceModel() {\n        return this._distanceModel;\n    }\n    set distanceModel(value) {\n        this._distanceModel = value;\n        _SetSpatialAudioProperty(this._subGraph, \"distanceModel\", value);\n    }\n    /** @internal */\n    get isAttached() {\n        return this._subGraph.getSubNode(\"Spatial\" /* AudioSubNode.SPATIAL */)?.isAttached ?? false;\n    }\n    /** @internal */\n    get maxDistance() {\n        return this._maxDistance;\n    }\n    set maxDistance(value) {\n        if (value <= 0) {\n            value = 0.000001;\n        }\n        this._maxDistance = value;\n        _SetSpatialAudioProperty(this._subGraph, \"maxDistance\", value);\n    }\n    /** @internal */\n    get minDistance() {\n        return this._minDistance;\n    }\n    set minDistance(value) {\n        this._minDistance = value;\n        _SetSpatialAudioProperty(this._subGraph, \"minDistance\", value);\n    }\n    /** @internal */\n    get orientation() {\n        return this._orientation;\n    }\n    set orientation(value) {\n        this._orientation = value;\n        this._updateRotation();\n    }\n    /** @internal */\n    get panningModel() {\n        return this._panningModel;\n    }\n    set panningModel(value) {\n        this._panningModel = value;\n        _SetSpatialAudioProperty(this._subGraph, \"panningModel\", value);\n    }\n    /** @internal */\n    get position() {\n        return this._position;\n    }\n    set position(value) {\n        this._position = value;\n        this._updatePosition();\n    }\n    /** @internal */\n    get rolloffFactor() {\n        return this._rolloffFactor;\n    }\n    set rolloffFactor(value) {\n        this._rolloffFactor = value;\n        _SetSpatialAudioProperty(this._subGraph, \"rolloffFactor\", value);\n    }\n    /** @internal */\n    get rotation() {\n        return this._rotation;\n    }\n    set rotation(value) {\n        this._rotation = value;\n        this._updateRotation();\n    }\n    /** @internal */\n    get rotationQuaternion() {\n        return this._rotationQuaternion;\n    }\n    set rotationQuaternion(value) {\n        this._rotationQuaternion = value;\n        this._updateRotation();\n    }\n    /**\n     * Attaches to a scene node.\n     *\n     * Detaches automatically before attaching to the given scene node.\n     * If `sceneNode` is `null` it is the same as calling `detach()`.\n     *\n     * @param sceneNode The scene node to attach to, or `null` to detach.\n     * @param useBoundingBox Whether to use the bounding box of the node for positioning. Defaults to `false`.\n     * @param attachmentType Whether to attach to the node's position and/or rotation. Defaults to `PositionAndRotation`.\n     */\n    attach(sceneNode, useBoundingBox = false, attachmentType = 3 /* SpatialAudioAttachmentType.PositionAndRotation */) {\n        _GetSpatialAudioSubNode(this._subGraph)?.attach(sceneNode, useBoundingBox, attachmentType);\n    }\n    /**\n     * Detaches from the scene node if attached.\n     */\n    detach() {\n        _GetSpatialAudioSubNode(this._subGraph)?.detach();\n    }\n    /** @internal */\n    update() {\n        const subNode = _GetSpatialAudioSubNode(this._subGraph);\n        if (!subNode) {\n            return;\n        }\n        if (subNode.isAttached) {\n            subNode.update();\n        }\n        else {\n            this._updatePosition(subNode);\n            this._updateRotation(subNode);\n        }\n    }\n    _updatePosition(subNode = null) {\n        if (!subNode) {\n            subNode = _GetSpatialAudioSubNode(this._subGraph);\n            if (!subNode) {\n                return;\n            }\n        }\n        const position = subNode.position;\n        if (!position.equalsWithEpsilon(this._position)) {\n            subNode.position.copyFrom(this._position);\n            subNode._updatePosition();\n        }\n    }\n    _updateRotation(subNode = null) {\n        if (!subNode) {\n            subNode = _GetSpatialAudioSubNode(this._subGraph);\n            if (!subNode) {\n                return;\n            }\n        }\n        if (!subNode.rotationQuaternion.equalsWithEpsilon(this._rotationQuaternion)) {\n            subNode.rotationQuaternion.copyFrom(this._rotationQuaternion);\n            subNode._updateRotation();\n            this._orientation.copyFrom(subNode.orientation);\n            this._rotation.copyFrom(subNode.rotation);\n        }\n        else if (!subNode.rotation.equalsWithEpsilon(this._rotation)) {\n            subNode.rotation.copyFrom(this._rotation);\n            subNode._updateRotation();\n            this._orientation.copyFrom(subNode.orientation);\n            this._rotationQuaternion.copyFrom(subNode.rotationQuaternion);\n        }\n        else if (!subNode.orientation.equalsWithEpsilon(this._orientation)) {\n            subNode.orientation.copyFrom(this._orientation);\n            subNode._updateRotation();\n            this._rotation.copyFrom(subNode.rotation);\n            this._rotationQuaternion.copyFrom(subNode.rotationQuaternion);\n        }\n    }\n}\n//# sourceMappingURL=spatialAudio.js.map","import { _SpatialAudio } from \"../../abstractAudio/subProperties/spatialAudio\";\nimport { _SpatialWebAudioUpdaterComponent } from \"../components/spatialWebAudioUpdaterComponent\";\n/** @internal */\nexport class _SpatialWebAudio extends _SpatialAudio {\n    /** @internal */\n    constructor(subGraph, autoUpdate, minUpdateTime) {\n        super(subGraph);\n        this._updaterComponent = new _SpatialWebAudioUpdaterComponent(this, autoUpdate, minUpdateTime);\n    }\n    /** @internal */\n    get minUpdateTime() {\n        return this._updaterComponent.minUpdateTime;\n    }\n    /** @internal */\n    set minUpdateTime(value) {\n        this._updaterComponent.minUpdateTime = value;\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._updaterComponent.dispose();\n        this._updaterComponent = null;\n    }\n}\n//# sourceMappingURL=spatialWebAudio.js.map"],"names":["_SpatialAudioDefaults","coneInnerAngle","coneOuterAngle","coneOuterVolume","distanceModel","maxDistance","minDistance","orientation","Vector3","Right","panningModel","position","Zero","rolloffFactor","rotation","rotationQuaternion","Quaternion","_HasSpatialAudioOptions","options","spatialEnabled","undefined","spatialAutoUpdate","spatialConeInnerAngle","spatialConeOuterAngle","spatialConeOuterVolume","spatialDistanceModel","spatialMaxDistance","spatialMinDistance","spatialMinUpdateTime","spatialOrientation","spatialPanningModel","spatialPosition","spatialRolloffFactor","spatialRotation","spatialRotationQuaternion","AbstractSpatialAudio","_StereoAudioDefaults","AbstractStereoAudio","_StereoAudioSubNode","_AbstractAudioSubNode","constructor","engine","super","setOptions","this","pan","stereoPan","_GetStereoAudioSubNode","subGraph","getSubNode","_StereoAudio","_pan","_subGraph","value","property","callOnSubNode","node","_SetStereoAudioProperty","_SpatialAudioSubNode","_attacherComponent","isAttached","attach","sceneNode","useBoundingBox","attachmentType","detach","_SpatialAudioAttacherComponent","dispose","clone","update","_updatePosition","_updateRotation","_GetSpatialAudioSubNode","_SetSpatialAudioProperty","TmpMatrix","Matrix","TmpQuaternion","D2r","degrees","Math","PI","R2d","radians","_SpatialWebAudioSubNode","_lastOrientation","_lastPosition","_lastRotation","_lastRotationQuaternion","PannerNode","_audioContext","_orientationX","_WebAudioParameterComponent","orientationX","_orientationY","orientationY","_orientationZ","orientationZ","_positionX","positionX","_positionY","positionY","_positionZ","positionZ","disconnect","coneOuterGain","refDistance","_inNode","_outNode","equalsWithEpsilon","targetValue","x","y","z","copyFrom","rotated","FromEulerAnglesToRef","FromQuaternionToRef","TransformNormalToRef","RightReadOnly","_connect","connect","_disconnect","getClassName","_StereoWebAudioSubNode","StereoPannerNode","_WebAudioBusAndSoundSubGraph","_WebAudioBaseSubGraph","arguments","_rootNode","_inputNode","initAsync","hasSpatialOptions","hasStereoOptions","createAndAddSubNodeAsync","stereoEnabled","_HasStereoAudioOptions","_createSubNodePromisesResolvedAsync","_createSubNode","name","e","async","_CreateSpatialAudioSubNodeAsync","_owner","_CreateStereoAudioSubNodeAsync","Error","_onSubNodesChanged","spatialNode","stereoNode","volumeNode","_GetVolumeAudioSubNode","disconnectAll","GainNode","inSubNode","inNode","_upstreamNodes","it","values","next","done","_SpatialAudio","_coneInnerAngle","_coneOuterAngle","_coneOuterVolume","_distanceModel","_maxDistance","_minDistance","_panningModel","_rolloffFactor","subNode","_orientation","_position","_rotation","_rotationQuaternion","removeSubNodeAsync","_SpatialWebAudio","autoUpdate","minUpdateTime","_updaterComponent","_SpatialWebAudioUpdaterComponent"],"mappings":"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"}