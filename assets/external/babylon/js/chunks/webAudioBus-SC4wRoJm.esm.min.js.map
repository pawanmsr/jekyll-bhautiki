{"version":3,"file":"webAudioBus-SC4wRoJm.esm.min.js","sources":["../../../../../dev/core/dist/AudioV2/abstractAudio/audioBus.js","../../../../../dev/core/dist/AudioV2/webAudio/webAudioBus.js"],"sourcesContent":["import { AbstractAudioBus } from \"./abstractAudioBus\";\n/**\n * Abstract class for an audio bus that has spatial audio and stereo output capabilities.\n *\n * Instances of this class can be connected to other audio buses.\n *\n * Audio buses are created by the {@link CreateAudioBusAsync} function.\n */\nexport class AudioBus extends AbstractAudioBus {\n    constructor(name, engine, options) {\n        super(name, engine);\n        this._spatialAutoUpdate = true;\n        this._spatialMinUpdateTime = 0;\n        this._outBus = null;\n        this._spatial = null;\n        this._onOutBusDisposed = () => {\n            this.outBus = this.engine.defaultMainBus;\n        };\n        if (typeof options.spatialAutoUpdate === \"boolean\") {\n            this._spatialAutoUpdate = options.spatialAutoUpdate;\n        }\n        if (typeof options.spatialMinUpdateTime === \"number\") {\n            this._spatialMinUpdateTime = options.spatialMinUpdateTime;\n        }\n    }\n    /**\n     * The output bus of the audio bus. Defaults to the audio engine's default main bus.\n     */\n    get outBus() {\n        return this._outBus;\n    }\n    set outBus(outBus) {\n        if (this._outBus === outBus) {\n            return;\n        }\n        if (this._outBus) {\n            this._outBus.onDisposeObservable.removeCallback(this._onOutBusDisposed);\n            if (!this._disconnect(this._outBus)) {\n                throw new Error(\"Disconnect failed\");\n            }\n        }\n        this._outBus = outBus;\n        if (this._outBus) {\n            this._outBus.onDisposeObservable.add(this._onOutBusDisposed);\n            if (!this._connect(this._outBus)) {\n                throw new Error(\"Connect failed\");\n            }\n        }\n    }\n    /**\n     * The spatial audio features.\n     */\n    get spatial() {\n        if (this._spatial) {\n            return this._spatial;\n        }\n        return this._initSpatialProperty();\n    }\n    /**\n     * Releases associated resources.\n     */\n    dispose() {\n        super.dispose();\n        this._spatial?.dispose();\n        this._spatial = null;\n        this._outBus = null;\n    }\n    _initSpatialProperty() {\n        return (this._spatial = this._createSpatialProperty(this._spatialAutoUpdate, this._spatialMinUpdateTime));\n    }\n}\n//# sourceMappingURL=audioBus.js.map","import { AudioBus } from \"../abstractAudio/audioBus\";\nimport { _HasSpatialAudioOptions } from \"../abstractAudio/subProperties/abstractSpatialAudio\";\nimport { _StereoAudio } from \"../abstractAudio/subProperties/stereoAudio\";\nimport { _WebAudioBusAndSoundSubGraph } from \"./subNodes/webAudioBusAndSoundSubGraph\";\nimport { _SpatialWebAudio } from \"./subProperties/spatialWebAudio\";\n/** @internal */\nexport class _WebAudioBus extends AudioBus {\n    /** @internal */\n    constructor(name, engine, options) {\n        super(name, engine, options);\n        this._stereo = null;\n        this._subGraph = new _WebAudioBus._SubGraph(this);\n    }\n    /** @internal */\n    async _initAsync(options) {\n        if (options.outBus) {\n            this.outBus = options.outBus;\n        }\n        else {\n            await this.engine.isReadyPromise;\n            this.outBus = this.engine.defaultMainBus;\n        }\n        await this._subGraph.initAsync(options);\n        if (_HasSpatialAudioOptions(options)) {\n            this._initSpatialProperty();\n        }\n        this.engine._addNode(this);\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._stereo = null;\n        this.engine._removeNode(this);\n    }\n    /** @internal */\n    get _inNode() {\n        return this._subGraph._inNode;\n    }\n    /** @internal */\n    get _outNode() {\n        return this._subGraph._outNode;\n    }\n    /** @internal */\n    get stereo() {\n        return this._stereo ?? (this._stereo = new _StereoAudio(this._subGraph));\n    }\n    /** @internal */\n    getClassName() {\n        return \"_WebAudioBus\";\n    }\n    _createSpatialProperty(autoUpdate, minUpdateTime) {\n        return new _SpatialWebAudio(this._subGraph, autoUpdate, minUpdateTime);\n    }\n    _connect(node) {\n        const connected = super._connect(node);\n        if (!connected) {\n            return false;\n        }\n        if (node._inNode) {\n            this._outNode?.connect(node._inNode);\n        }\n        return true;\n    }\n    _disconnect(node) {\n        const disconnected = super._disconnect(node);\n        if (!disconnected) {\n            return false;\n        }\n        if (node._inNode) {\n            this._outNode?.disconnect(node._inNode);\n        }\n        return true;\n    }\n}\n_WebAudioBus._SubGraph = class extends _WebAudioBusAndSoundSubGraph {\n    get _downstreamNodes() {\n        return this._owner._downstreamNodes ?? null;\n    }\n    get _upstreamNodes() {\n        return this._owner._upstreamNodes ?? null;\n    }\n};\n//# sourceMappingURL=webAudioBus.js.map"],"names":["AudioBus","AbstractAudioBus","constructor","name","engine","options","super","this","_spatialAutoUpdate","_spatialMinUpdateTime","_outBus","_spatial","_onOutBusDisposed","outBus","defaultMainBus","spatialAutoUpdate","spatialMinUpdateTime","onDisposeObservable","removeCallback","_disconnect","Error","add","_connect","spatial","_initSpatialProperty","dispose","_createSpatialProperty","_WebAudioBus","_stereo","_subGraph","_SubGraph","_initAsync","isReadyPromise","initAsync","_HasSpatialAudioOptions","_addNode","_removeNode","_inNode","_outNode","stereo","_StereoAudio","getClassName","autoUpdate","minUpdateTime","_SpatialWebAudio","node","connect","disconnect","_WebAudioBusAndSoundSubGraph","_downstreamNodes","_owner","_upstreamNodes"],"mappings":"2QAQO,MAAMA,UAAiBC,EAC1B,WAAAC,CAAYC,EAAMC,EAAQC,GACtBC,MAAMH,EAAMC,GACZG,KAAKC,oBAAqB,EAC1BD,KAAKE,sBAAwB,EAC7BF,KAAKG,QAAU,KACfH,KAAKI,SAAW,KAChBJ,KAAKK,kBAAoB,KACrBL,KAAKM,OAASN,KAAKH,OAAOU,gBAEW,kBAA9BT,EAAQU,oBACfR,KAAKC,mBAAqBH,EAAQU,mBAEM,iBAAjCV,EAAQW,uBACfT,KAAKE,sBAAwBJ,EAAQW,qBAEjD,CAII,UAAIH,GACA,OAAON,KAAKG,OACpB,CACI,UAAIG,CAAOA,GACP,GAAIN,KAAKG,UAAYG,EAArB,CAGA,GAAIN,KAAKG,UACLH,KAAKG,QAAQO,oBAAoBC,eAAeX,KAAKK,oBAChDL,KAAKY,YAAYZ,KAAKG,UACvB,MAAM,IAAIU,MAAM,qBAIxB,GADAb,KAAKG,QAAUG,EACXN,KAAKG,UACLH,KAAKG,QAAQO,oBAAoBI,IAAId,KAAKK,oBACrCL,KAAKe,SAASf,KAAKG,UACpB,MAAM,IAAIU,MAAM,iBAXhC,CAcA,CAII,WAAIG,GACA,OAAIhB,KAAKI,SACEJ,KAAKI,SAETJ,KAAKiB,sBACpB,CAII,OAAAC,GACInB,MAAMmB,UACNlB,KAAKI,UAAUc,UACflB,KAAKI,SAAW,KAChBJ,KAAKG,QAAU,IACvB,CACI,oBAAAc,GACI,OAAQjB,KAAKI,SAAWJ,KAAKmB,uBAAuBnB,KAAKC,mBAAoBD,KAAKE,sBAC1F,EC/DO,MAAMkB,UAAqB3B,EAE9B,WAAAE,CAAYC,EAAMC,EAAQC,GACtBC,MAAMH,EAAMC,EAAQC,GACpBE,KAAKqB,QAAU,KACfrB,KAAKsB,UAAY,IAAIF,EAAaG,UAAUvB,KACpD,CAEI,gBAAMwB,CAAW1B,GACTA,EAAQQ,OACRN,KAAKM,OAASR,EAAQQ,cAGhBN,KAAKH,OAAO4B,eAClBzB,KAAKM,OAASN,KAAKH,OAAOU,sBAExBP,KAAKsB,UAAUI,UAAU5B,GAC3B6B,EAAwB7B,IACxBE,KAAKiB,uBAETjB,KAAKH,OAAO+B,SAAS5B,KAC7B,CAEI,OAAAkB,GACInB,MAAMmB,UACNlB,KAAKqB,QAAU,KACfrB,KAAKH,OAAOgC,YAAY7B,KAChC,CAEI,WAAI8B,GACA,OAAO9B,KAAKsB,UAAUQ,OAC9B,CAEI,YAAIC,GACA,OAAO/B,KAAKsB,UAAUS,QAC9B,CAEI,UAAIC,GACA,OAAOhC,KAAKqB,UAAYrB,KAAKqB,QAAU,IAAIY,EAAajC,KAAKsB,WACrE,CAEI,YAAAY,GACI,MAAO,cACf,CACI,sBAAAf,CAAuBgB,EAAYC,GAC/B,OAAO,IAAIC,EAAiBrC,KAAKsB,UAAWa,EAAYC,EAChE,CACI,QAAArB,CAASuB,GAEL,QADkBvC,MAAMgB,SAASuB,KAI7BA,EAAKR,SACL9B,KAAK+B,UAAUQ,QAAQD,EAAKR,UAEzB,EACf,CACI,WAAAlB,CAAY0B,GAER,QADqBvC,MAAMa,YAAY0B,KAInCA,EAAKR,SACL9B,KAAK+B,UAAUS,WAAWF,EAAKR,UAE5B,EACf,EAEAV,EAAaG,UAAY,cAAckB,EACnC,oBAAIC,GACA,OAAO1C,KAAK2C,OAAOD,kBAAoB,IAC/C,CACI,kBAAIE,GACA,OAAO5C,KAAK2C,OAAOC,gBAAkB,IAC7C"}