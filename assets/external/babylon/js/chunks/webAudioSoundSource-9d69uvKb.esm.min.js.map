{"version":3,"file":"webAudioSoundSource-9d69uvKb.esm.min.js","sources":["../../../../../dev/core/dist/AudioV2/webAudio/webAudioSoundSource.js"],"sourcesContent":["import { AbstractSoundSource } from \"../abstractAudio/abstractSoundSource\";\nimport { _HasSpatialAudioOptions } from \"../abstractAudio/subProperties/abstractSpatialAudio\";\nimport { _StereoAudio } from \"../abstractAudio/subProperties/stereoAudio\";\nimport { _WebAudioBusAndSoundSubGraph } from \"./subNodes/webAudioBusAndSoundSubGraph\";\nimport { _SpatialWebAudio } from \"./subProperties/spatialWebAudio\";\n/** @internal */\nexport class _WebAudioSoundSource extends AbstractSoundSource {\n    /** @internal */\n    constructor(name, webAudioNode, engine, options) {\n        super(name, engine, options);\n        this._stereo = null;\n        this._webAudioNode = null;\n        this._audioContext = this.engine._audioContext;\n        this._webAudioNode = webAudioNode;\n        this._subGraph = new _WebAudioSoundSource._SubGraph(this);\n    }\n    /** @internal */\n    async _initAsync(options) {\n        if (options.outBus) {\n            this.outBus = options.outBus;\n        }\n        else if (options.outBusAutoDefault !== false) {\n            await this.engine.isReadyPromise;\n            this.outBus = this.engine.defaultMainBus;\n        }\n        await this._subGraph.initAsync(options);\n        if (_HasSpatialAudioOptions(options)) {\n            this._initSpatialProperty();\n        }\n        this.engine._addNode(this);\n    }\n    /** @internal */\n    get _inNode() {\n        return this._webAudioNode;\n    }\n    /** @internal */\n    get _outNode() {\n        return this._subGraph._outNode;\n    }\n    /** @internal */\n    get stereo() {\n        return this._stereo ?? (this._stereo = new _StereoAudio(this._subGraph));\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        if (this._webAudioNode) {\n            if (this._webAudioNode instanceof MediaStreamAudioSourceNode) {\n                for (const track of this._webAudioNode.mediaStream.getTracks()) {\n                    track.stop();\n                }\n            }\n            this._webAudioNode.disconnect();\n            this._webAudioNode = null;\n        }\n        this._stereo = null;\n        this._subGraph.dispose();\n        this.engine._removeNode(this);\n    }\n    /** @internal */\n    getClassName() {\n        return \"_WebAudioSoundSource\";\n    }\n    _connect(node) {\n        const connected = super._connect(node);\n        if (!connected) {\n            return false;\n        }\n        // If the wrapped node is not available now, it will be connected later by the subgraph.\n        if (node._inNode) {\n            this._outNode?.connect(node._inNode);\n        }\n        return true;\n    }\n    _disconnect(node) {\n        const disconnected = super._disconnect(node);\n        if (!disconnected) {\n            return false;\n        }\n        if (node._inNode) {\n            this._outNode?.disconnect(node._inNode);\n        }\n        return true;\n    }\n    _createSpatialProperty(autoUpdate, minUpdateTime) {\n        return new _SpatialWebAudio(this._subGraph, autoUpdate, minUpdateTime);\n    }\n}\n_WebAudioSoundSource._SubGraph = class extends _WebAudioBusAndSoundSubGraph {\n    get _downstreamNodes() {\n        return this._owner._downstreamNodes ?? null;\n    }\n    get _upstreamNodes() {\n        return this._owner._upstreamNodes ?? null;\n    }\n    _onSubNodesChanged() {\n        super._onSubNodesChanged();\n        this._owner._inNode?.disconnect();\n        if (this._owner._subGraph._inNode) {\n            this._owner._inNode?.connect(this._owner._subGraph._inNode);\n        }\n    }\n};\n//# sourceMappingURL=webAudioSoundSource.js.map"],"names":["_WebAudioSoundSource","AbstractSoundSource","constructor","name","webAudioNode","engine","options","super","this","_stereo","_webAudioNode","_audioContext","_subGraph","_SubGraph","_initAsync","outBus","outBusAutoDefault","isReadyPromise","defaultMainBus","initAsync","_HasSpatialAudioOptions","_initSpatialProperty","_addNode","_inNode","_outNode","stereo","_StereoAudio","dispose","MediaStreamAudioSourceNode","track","mediaStream","getTracks","stop","disconnect","_removeNode","getClassName","_connect","node","connect","_disconnect","_createSpatialProperty","autoUpdate","minUpdateTime","_SpatialWebAudio","_WebAudioBusAndSoundSubGraph","_downstreamNodes","_owner","_upstreamNodes","_onSubNodesChanged"],"mappings":"8QAMO,MAAMA,UAA6BC,EAEtC,WAAAC,CAAYC,EAAMC,EAAcC,EAAQC,GACpCC,MAAMJ,EAAME,EAAQC,GACpBE,KAAKC,QAAU,KACfD,KAAKE,cAAgB,KACrBF,KAAKG,cAAgBH,KAAKH,OAAOM,cACjCH,KAAKE,cAAgBN,EACrBI,KAAKI,UAAY,IAAIZ,EAAqBa,UAAUL,KAC5D,CAEI,gBAAMM,CAAWR,GACTA,EAAQS,OACRP,KAAKO,OAAST,EAAQS,QAEa,IAA9BT,EAAQU,0BACPR,KAAKH,OAAOY,eAClBT,KAAKO,OAASP,KAAKH,OAAOa,sBAExBV,KAAKI,UAAUO,UAAUb,GAC3Bc,EAAwBd,IACxBE,KAAKa,uBAETb,KAAKH,OAAOiB,SAASd,KAC7B,CAEI,WAAIe,GACA,OAAOf,KAAKE,aACpB,CAEI,YAAIc,GACA,OAAOhB,KAAKI,UAAUY,QAC9B,CAEI,UAAIC,GACA,OAAOjB,KAAKC,UAAYD,KAAKC,QAAU,IAAIiB,EAAalB,KAAKI,WACrE,CAEI,OAAAe,GAEI,GADApB,MAAMoB,UACFnB,KAAKE,cAAe,CACpB,GAAIF,KAAKE,yBAAyBkB,2BAC9B,IAAK,MAAMC,KAASrB,KAAKE,cAAcoB,YAAYC,YAC/CF,EAAMG,OAGdxB,KAAKE,cAAcuB,aACnBzB,KAAKE,cAAgB,IACjC,CACQF,KAAKC,QAAU,KACfD,KAAKI,UAAUe,UACfnB,KAAKH,OAAO6B,YAAY1B,KAChC,CAEI,YAAA2B,GACI,MAAO,sBACf,CACI,QAAAC,CAASC,GAEL,QADkB9B,MAAM6B,SAASC,KAK7BA,EAAKd,SACLf,KAAKgB,UAAUc,QAAQD,EAAKd,UAEzB,EACf,CACI,WAAAgB,CAAYF,GAER,QADqB9B,MAAMgC,YAAYF,KAInCA,EAAKd,SACLf,KAAKgB,UAAUS,WAAWI,EAAKd,UAE5B,EACf,CACI,sBAAAiB,CAAuBC,EAAYC,GAC/B,OAAO,IAAIC,EAAiBnC,KAAKI,UAAW6B,EAAYC,EAChE,EAEA1C,EAAqBa,UAAY,cAAc+B,EAC3C,oBAAIC,GACA,OAAOrC,KAAKsC,OAAOD,kBAAoB,IAC/C,CACI,kBAAIE,GACA,OAAOvC,KAAKsC,OAAOC,gBAAkB,IAC7C,CACI,kBAAAC,GACIzC,MAAMyC,qBACNxC,KAAKsC,OAAOvB,SAASU,aACjBzB,KAAKsC,OAAOlC,UAAUW,SACtBf,KAAKsC,OAAOvB,SAASe,QAAQ9B,KAAKsC,OAAOlC,UAAUW,QAE/D"}